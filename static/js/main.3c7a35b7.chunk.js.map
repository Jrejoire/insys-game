{"version":3,"sources":["components/SceneComponent.jsx","components/armies.js","components/Scene.js","App.js","serviceWorker.js","index.js"],"names":["props","reactCanvas","useRef","sceneOptions","antialias","engineOptions","adaptToDeviceRatio","onRender","rest","onSceneReady","useState","loaded","setLoaded","scene","setScene","useEffect","window","resize","getEngine","addEventListener","removeEventListener","engine","Engine","current","stencil","Scene","isReady","onReadyObservable","addOnce","runRenderLoop","render","dispose","ref","armies","tabForces","units","soldier","class","move","defense","roll","success","melee","range","mods","s","m","l","xl","maxRange","maxInGame","undefined","cost","sysTroops","rebels","outerRing","voidWarriors","BABYLON","AllowMatricesInterpolation","canvas","getRenderingCanvas","advancedTexture","AdvancedDynamicTexture","CreateFullscreenUI","isForeground","camera","ToRadians","attachControl","angularsensibility","checkCollisions","ellipsoid","light","intensity","shadowGenerator","usePoissonSampling","hl","innerGlow","invisibleMaterial","alpha","transparentMaterial","skybox","CreateSphere","diameter","diameterX","skyboxMaterial","backFaceCulling","material","receiveShadows","background","CreateCylinder","height","tessellation","backgroundMaterial","opacityTexture","translate","Y","visibility","boardMaterial","diffuseTexture","bumpTexture","ambientTexture","groundMaterial","specularTexture","miniMaterial","diffuseColor","tokenMaterialBlack","tokenMaterialWhite","Black","White","diceMatWhite","diceMatBlack","diceMatRed","gameAreaTemplate","moveAreaMat","CustomMaterial","Fragment_Custom_Diffuse","lineOfSightMatW","lineOfSightMMatW","lineOfSightLMatW","lineOfSightXLMatW","lineOfSightMatB","lineOfSightMMatB","lineOfSightLMatB","lineOfSightXLMatB","actionToken","dice1","dice2","dice3","dice4","dice5","dice6","players","teamWhite","player","army","this","minis","startActions","turnActions","reduce","acc","value","armyStats","teamBlack","currentPlayer","team","enemyPlayer","mapActionManager","moveActionManager","teamBlackActionManager","teamWhiteActionManager","importActionTokens","ImportMesh","newMeshes","MergeMeshes","position","scaling","name","id","actionClone","dx","x","NB_CLONES","nbclone","clone","randomX","Math","floor","random","z","dice","X","Z","getShadowMap","renderList","push","collisionGroup","collisionMask","setEnabled","rotate","LOS","LOSM","LOSL","parent","los","FromMesh","losM","losL","slicer","CreateBox","width","depth","slicerCSG","subtract","lineOfSight","toMesh","lineOfSightM","lineOfSightL","isPickable","shield","getLosColor","unit","losColorBad","losColorMalus","losColorZero","losColorBonus","getHeight","mesh","getBoundingInfo","boundingBox","extendSize","y","getWidth","getLength","getControlByName","_rootContainer","_children","filter","control","asyncForEach","array","callback","a","index","length","clonedMini","importMiniModel","miniName","mini","toLowerCase","rotation","actionManager","enablePointerMoveEvents","base","createBase","miniLOS","losMat","createLOS","miniShield","createShield","setTarget","forEach","obstacles","container","redMat","greyMat","greenMat","container0","container2","container02","container3","container4","container5","container6","container7","container8","container78","container9","container10","container11","container12","moveArea","miniWidth","board","map","moveArea2","switchPlayer","targetFurthestMini","selected","targets","inAttack","previous","cancelTargeting","target","removeMesh","getMeshByName","removeDiceStat","diceAssigned","removeControl","rollButton","selection","evt","sourceEvent","which","currentMesh","meshUnderPointer","hoverCursor","moveAction","skip","includes","addMesh","cancelSelection","rotateOnMouseMove","isInCover","mini1","mini2","originLeft","originRight","directionLeft","Normalize","directionRight","rayLeft","rayRight","hitsLeft","multiPickWithRay","hitsRight","some","hit","pickedMesh","isInAngle","forward","forwardDirection","origin","directionTarget","acos","Dot","PI","whatIsUnderneath","origin2","origin3","origin4","direction","ray","ray2","ray3","ray4","hits","hits2","hits3","hits4","removeCoverLogo","handleLineOfSight","ev","enemyTarget","rangeToTarget","calculateSuccess","intersectsMesh","cancelLineOfSight","miniPosition","furthestMiniIndex","indexOf","min","max","furthestMini","furthestTarget","size","setTimeout","diceRoll","rolls","arrayResult","i","cloneDice","delay","save","dicePosition1","dicePosition2","dicePosition3","diceOddPosition3","dicePosition4","dicePosition5","diceOddPosition5","dicePositions","diceIndex","compareRolls","mini1Rolls","mini1Mod","mini2Rolls","mini2Mod","mini1Success","mini2Success","console","log","j","splice","rangeResult","distance","Distance","mini1Team","mini1MaxRange","targetLeft","targetRight","noObstacle","isTheGameOver","winner","getMods","higherMod","isHigher","onAttack","response","mini1CoverMod","mini1Mods","mini2CoverMod","mini2Mods","meleeRoll","mini2MeleeRoll","mini1rolls","modedRolls","defenseRoll","clearTarget","attackTargets","waitFor","ms","Promise","r","enemyResponse","onWayResponse","enemy","GUI","CreateSimpleButton","color","left","top","cornerRadius","zIndex","onPointerClickObservable","add","obstacleTemplateArea","round","highMat","getMaterialByName","child","getDirection","normalize","preventDefault","getGroundPosition","diffX","diffY","atan2","rotateAction","onMouseMove","obstacle","currentObstacle","pickinfo","pick","pointerX","pointerY","pickedPoint","addTarget","addControl","updateDiceStat","targetColor","createDirectLOS","createDiceStat","targetResponse","diceStat","text","fontFamily","fontSize","linkWithMesh","linkOffsetY","assignTarget","whoHasMoreDice","every","removedTarget","colorArray1","CreateLines","points","colors","updatable","colorArray2","registerAction","OnPointerOverTrigger","OnPointerOutTrigger","OnPickUpTrigger","OnLeftPickTrigger","onDispose","SceneComponent","className","App","Boolean","location","hostname","match","ReactDOM","StrictMode","document","getElementById","navigator","serviceWorker","ready","then","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.3c7a35b7.chunk.js","sourcesContent":["import { Engine, Scene } from '@babylonjs/core';\r\nimport React, { useEffect, useRef, useState } from 'react';\r\n\r\nexport default (props) => {\r\n    const reactCanvas = useRef(null);\r\n    const { antialias, engineOptions, adaptToDeviceRatio, sceneOptions, onRender, onSceneReady, ...rest } = props;\r\n\r\n    const [loaded, setLoaded] = useState(false);\r\n    const [scene, setScene] = useState(null);\r\n\r\n    useEffect(() => {\r\n        if (window) {\r\n            const resize = () => {\r\n                if (scene) {\r\n                    scene.getEngine().resize();\r\n                }\r\n            }\r\n            window.addEventListener('resize', resize);\r\n\r\n            return () => {\r\n                window.removeEventListener('resize', resize);\r\n            }\r\n        }\r\n    }, [scene]);\r\n\r\n    useEffect(() => {\r\n        if (!loaded) {\r\n            setLoaded(true);\r\n            const engine = new Engine(reactCanvas.current, true, { stencil: true });\r\n            const scene = new Scene(engine, sceneOptions);\r\n            setScene(scene);\r\n            if (scene.isReady()) {\r\n                props.onSceneReady(scene)\r\n            } else {\r\n                scene.onReadyObservable.addOnce(scene => props.onSceneReady(scene));\r\n            }\r\n\r\n            engine.runRenderLoop(() => {\r\n                if (typeof onRender === 'function') {\r\n                    onRender(scene);\r\n                }\r\n                scene.render();\r\n            })\r\n        }\r\n\r\n        return () => {\r\n            if (scene !== null) {\r\n                scene.dispose();\r\n            }\r\n        }\r\n    }, [loaded, sceneOptions, props, onRender, scene])\r\n\r\n    return (\r\n        <canvas ref={reactCanvas} {...rest} />\r\n    );\r\n}","export const armies = {\r\n    tabForces: {\r\n        units: { \r\n          soldier: {\r\n              class: \"FS\",\r\n              move: 4,\r\n              defense: { roll: 1, success: 4 },\r\n              melee: { roll: 1, success: 3 },\r\n              range: { roll: 1, success: 3, mods: { s: -1, m: 1, l: 0, xl: -1 } },\r\n              maxRange: 1212,\r\n              maxInGame: undefined,\r\n              cost: 10\r\n          }\r\n       },   \r\n    },\r\n    sysTroops: {\r\n        units: {\r\n          soldier: {\r\n              class: \"FS\",\r\n              move: 4,\r\n              defense: { roll: 1, success: 4 },\r\n              melee: { roll: 1, success: 3 },\r\n              range: { roll: 2, success: 4, mods: { s: 0, m: 1, l: -1, xl: -1 } },\r\n              maxRange: 1212,\r\n              maxInGame: undefined,\r\n              cost: 10\r\n          }\r\n       }\r\n    },\r\n    rebels: {\r\n        units : {\r\n          soldier: {\r\n              class: \"FS\",\r\n              move: 4,\r\n              defense: { roll: 1, success: 4 },\r\n              melee: { roll: 2, success: 4 },\r\n              range: { roll: 3, success: 5, mods: { s: 1, m: 0, l: -1, xl: -2 } },\r\n              maxRange: 1212,\r\n              maxInGame: undefined,\r\n              cost: 10\r\n          }\r\n        }\r\n    },\r\n    outerRing: {\r\n        units : {\r\n          soldier: {\r\n            class: \"FS\",\r\n            move: 4,\r\n            defense: { roll: 1, success: 4 },\r\n            melee: { roll: 2, success: 3 },\r\n            range: { roll: 1, success: 3, mods: { s: 1, m: 0, l: -2, xl: -2 } },\r\n            maxRange: 1212,\r\n            maxInGame: undefined,\r\n            cost: 10\r\n         }\r\n       }    \r\n    },\r\n    voidWarriors: {\r\n        units : {\r\n          soldier: {\r\n              class: \"FS\",\r\n              move: 4,\r\n              defense: { roll: 1, success: 4 },\r\n              melee: { roll: 4, success: 5 },\r\n              range: { roll: 3, success: 5, mods: { s: 0, m: 0, l: -1, xl: -2 } },\r\n              maxRange: 1212,\r\n              maxInGame: undefined,\r\n              cost: 10\r\n          }\r\n        }\r\n    }\r\n  }\r\n  ","import React from 'react';\r\nimport * as BABYLON from '@babylonjs/core';\r\nimport * as GUI from '@babylonjs/gui';\r\nimport { AdvancedDynamicTexture } from '@babylonjs/gui/2D';\r\nimport { CustomMaterial } from '@babylonjs/materials';\r\nimport SceneComponent from './SceneComponent';\r\nimport { armies } from './armies';\r\nimport '../App.css';\r\n\r\nBABYLON.Animation.AllowMatricesInterpolation = true;\r\n\r\nvar publicURL = \"\";\r\nif (process.env.NODE_ENV === \"development\") {\r\n  publicURL = process.env.PUBLIC_URL;\r\n}\r\n\r\n\r\nconst onSceneReady = scene => {\r\n  const canvas = scene.getEngine().getRenderingCanvas();\r\n  var advancedTexture = AdvancedDynamicTexture.CreateFullscreenUI(\r\n    \"sceneUI\"\r\n  );\r\n  advancedTexture.isForeground = true;\r\n\r\n  var camera = new BABYLON.ArcRotateCamera(\"arcCamera\",\r\n    BABYLON.Tools.ToRadians(0),\r\n    BABYLON.Tools.ToRadians(100),\r\n    780, new BABYLON.Vector3(-60, 400, 0), scene\r\n  );\r\n  //Setting up camera         \r\n  camera.attachControl(canvas, true);\r\n  camera.angularsensibility *= -1;\r\n  camera.checkCollisions = true;\r\n  camera.ellipsoid = new BABYLON.Vector3(1.5, 1, 1.5);\r\n\r\n  //Setting lights and shadows\r\n  var light = new BABYLON.PointLight(\"pointLight\", new BABYLON.Vector3(75, 400, 150), scene);\r\n  light.intensity = 1;\r\n  light.range = 5000;\r\n\r\n  var light2 = new BABYLON.HemisphericLight(\"hemiLight\", new BABYLON.Vector3(0, -4900, 0), scene);\r\n  //Colored backlight => \r\n  //light2.diffuse = new BABYLON.Color3(0.3, 0.2, 0.9);\r\n  light2.intensity = 0.7;\r\n\r\n  var shadowGenerator = new BABYLON.ShadowGenerator(1024, light);\r\n  shadowGenerator.usePoissonSampling = true;\r\n\r\n  var hl = new BABYLON.HighlightLayer(\"hl1\", scene);\r\n  hl.innerGlow = false;\r\n\r\n  //Materials;\r\n  var invisibleMaterial = new BABYLON.StandardMaterial(\"invisibleMaterial\", scene);\r\n  invisibleMaterial.alpha = 0;\r\n\r\n  var transparentMaterial = new BABYLON.StandardMaterial(\"transparentMaterial\", scene);\r\n  transparentMaterial.alpha = 0.5;\r\n\r\n  var skybox = BABYLON.MeshBuilder.CreateSphere(\"skyBox\", { diameter: 5500, diameterX: 5500 }, scene);\r\n  var skyboxMaterial = new BABYLON.StandardMaterial(\"skyBox\", scene);\r\n  skyboxMaterial.backFaceCulling = false;\r\n  skybox.material = skyboxMaterial;\r\n  skybox.receiveShadows = true;\r\n\r\n  var background = BABYLON.MeshBuilder.CreateCylinder(\"background\", { height: 1, diameter: 5000, tessellation: 5000 }, scene);\r\n  var backgroundMaterial = new BABYLON.StandardMaterial(\"background\", scene);\r\n  backgroundMaterial.opacityTexture = new BABYLON.Texture(`.${publicURL}/Textures/OpacityTemplate.png`, scene);\r\n  backgroundMaterial.backFaceCulling = false;\r\n  background.material = backgroundMaterial;\r\n  background.translate(BABYLON.Axis.Y, -1, scene);\r\n  background.visibility = 0.4;\r\n  background.receiveShadows = true;\r\n\r\n  var boardMaterial = new BABYLON.StandardMaterial(\"boardMaterial\", scene);\r\n  boardMaterial.diffuseTexture = new BABYLON.Texture(`.${publicURL}/Textures/Wood/Wood_021_basecolor.jpg`, scene);\r\n  boardMaterial.bumpTexture = new BABYLON.Texture(`.${publicURL}/Textures/Wood/Wood_021_normal.jpg`, scene);\r\n  boardMaterial.ambientTexture = new BABYLON.Texture(`.${publicURL}/Textures/Wood/Wood_021_ambientOcclusion.jpg`, scene);\r\n\r\n  var groundMaterial = new BABYLON.StandardMaterial(\"asphaltMaterial\", scene);\r\n  groundMaterial.diffuseTexture = new BABYLON.Texture(`.${publicURL}/Textures/Asphalt/Asphalt_001_COLOR.jpg`, scene);\r\n  groundMaterial.bumpTexture = new BABYLON.Texture(`.${publicURL}/Textures/Asphalt/Asphalt_001_NRM.jpg`, scene);\r\n  groundMaterial.specularTexture = new BABYLON.Texture(`.${publicURL}/Textures/Asphalt/Asphalt_001_SPEC.jpg`, scene);\r\n  groundMaterial.ambientTexture = new BABYLON.Texture(`.${publicURL}/Textures/Asphalt/Asphalt_001_OCC.jpg`, scene);\r\n\r\n  var miniMaterial = new BABYLON.StandardMaterial(\"plasticMaterial\", scene);\r\n  miniMaterial.diffuseColor = new BABYLON.Color3(220 / 255, 220 / 255, 220 / 255);\r\n\r\n  var tokenMaterialBlack = new BABYLON.StandardMaterial(\"tokenMaterial\", scene);\r\n  tokenMaterialBlack.diffuseTexture = new BABYLON.Texture(`.${publicURL}/Textures/Token/Coin_low_Coin_material_BaseColor2.png`, scene);\r\n  tokenMaterialBlack.bumpTexture = new BABYLON.Texture(`.${publicURL}/Textures/Token/Coin_low_Coin_material_Normal.png`, scene);\r\n\r\n  var tokenMaterialWhite = new BABYLON.StandardMaterial(\"tokenMaterial\", scene);\r\n  tokenMaterialWhite.diffuseTexture = new BABYLON.Texture(`.${publicURL}/Textures/Token/Coin_low_Coin_material_BaseColor.png`, scene);\r\n  tokenMaterialWhite.bumpTexture = new BABYLON.Texture(`.${publicURL}/Textures/Token/Coin_low_Coin_material_Normal.png`, scene);\r\n\r\n  var baseMaterialBlack = new BABYLON.StandardMaterial(\"baseMaterial\", scene);\r\n  baseMaterialBlack.diffuseColor = new BABYLON.Color3.Black();\r\n\r\n  var baseMaterialWhite = new BABYLON.StandardMaterial(\"baseMaterial\", scene);\r\n  baseMaterialWhite.diffuseColor = new BABYLON.Color3.White();\r\n\r\n  var diceMatWhite = new BABYLON.StandardMaterial(\"diceMatWhite\", scene);\r\n  diceMatWhite.diffuseColor = new BABYLON.Color3.White();\r\n\r\n  var diceMatBlack = new BABYLON.StandardMaterial(\"diceMatBlack\", scene);\r\n  //diceMatBlack.diffuseColor = new BABYLON.Color3(55 / 255, 71 / 255, 79 / 255);\r\n  diceMatBlack.diffuseColor = new BABYLON.Color3.Black();\r\n\r\n  var diceMatRed = new BABYLON.StandardMaterial(\"diceMatRed\", scene);\r\n  diceMatRed.diffuseColor = new BABYLON.Color3(164 / 255, 27 / 255, 7 / 255);\r\n\r\n  var gameAreaTemplate = 'if( vPositionW.z  < -340.){ discard; } if( vPositionW.z  > 340.){ discard; } if( vPositionW.x  > 450.){ discard; } if( vPositionW.x  < -450.){ discard; }';\r\n\r\n  var moveAreaMat = new CustomMaterial(\"moveAreaMat\", scene);\r\n  moveAreaMat.alpha = 0.25;\r\n  moveAreaMat.Fragment_Custom_Diffuse(gameAreaTemplate);\r\n\r\n  var lineOfSightTransparency = 0.25;\r\n\r\n  var lineOfSightMatW = new CustomMaterial(\"losMatSW\", scene);\r\n  lineOfSightMatW.alpha = lineOfSightTransparency;\r\n  lineOfSightMatW.Fragment_Custom_Diffuse(gameAreaTemplate);\r\n\r\n  var lineOfSightMMatW = new CustomMaterial(\"losMatMW\", scene);\r\n  lineOfSightMMatW.alpha = lineOfSightTransparency;\r\n  lineOfSightMMatW.Fragment_Custom_Diffuse(gameAreaTemplate);\r\n\r\n  var lineOfSightLMatW = new CustomMaterial(\"losMatLW\", scene);\r\n  lineOfSightLMatW.alpha = lineOfSightTransparency;\r\n  lineOfSightLMatW.Fragment_Custom_Diffuse(gameAreaTemplate);\r\n\r\n  var lineOfSightXLMatW = new CustomMaterial(\"losMatXLW\", scene);\r\n  lineOfSightXLMatW.alpha = lineOfSightTransparency;\r\n  lineOfSightXLMatW.Fragment_Custom_Diffuse(gameAreaTemplate);\r\n\r\n  var lineOfSightMatB = new CustomMaterial(\"losMatSB\", scene);\r\n  lineOfSightMatB.alpha = lineOfSightTransparency;\r\n  lineOfSightMatB.Fragment_Custom_Diffuse(gameAreaTemplate);\r\n\r\n  var lineOfSightMMatB = new CustomMaterial(\"losMatMB\", scene);\r\n  lineOfSightMMatB.alpha = lineOfSightTransparency;\r\n  lineOfSightMMatB.Fragment_Custom_Diffuse(gameAreaTemplate);\r\n\r\n  var lineOfSightLMatB = new CustomMaterial(\"losMatLB\", scene);\r\n  lineOfSightLMatB.alpha = lineOfSightTransparency;\r\n  lineOfSightLMatB.Fragment_Custom_Diffuse(gameAreaTemplate);\r\n\r\n  var lineOfSightXLMatB = new CustomMaterial(\"losMatXLB\", scene);\r\n  lineOfSightXLMatB.alpha = lineOfSightTransparency;\r\n  lineOfSightXLMatB.Fragment_Custom_Diffuse(gameAreaTemplate);\r\n\r\n  //Game initiation\r\n  // Associate Users with teams (teamWhite || teamBlack);\r\n  // example: teamWhite.player = \"@jrej\";\r\n  // example: teamBlack.player = \"@inkito\";\r\n\r\n  var players = {\r\n    teamWhite: {\r\n      player: \"@jrej\",\r\n      army: \"rebels\",\r\n      get armyStats() { return armies[this.army] },\r\n      units: [\"OTTMK\", \"OTTMK\", \"OTTMK\"],\r\n      minis: [],\r\n      startActions: 6,\r\n      turnActions: 6,\r\n      //Army value would be calculated at the time of unit selection\r\n      get armyValue() { return this.units.reduce((acc, value) => { return acc + this.armyStats[\"units\"][value][\"cost\"] }, 0) }\r\n    },\r\n    teamBlack: {\r\n      player: \"@inkito\",\r\n      army: \"tabForces\",\r\n      get armyStats() { return armies[this.army] },\r\n      units: [\"STLRW\", \"STLRW\", \"STLRW\"],\r\n      minis: [],\r\n      startActions: 6,\r\n      turnActions: 6,\r\n      //Army value would be calculated at the time of unit selection\r\n      get armyValue() { return this.units.reduce((acc, value) => { return acc + this.armyStats[\"units\"][value][\"cost\"] }, 0) }\r\n    }\r\n  };\r\n\r\n  // Proceed to initiative roll to decide currentPlayer;\r\n  var currentPlayer = {\r\n    team: \"teamWhite\",\r\n    get player() { return players[this.team].player },\r\n    get army() { return players[this.team].armyStats },\r\n    get startActions() { return players[this.team].startActions },\r\n    get turnActions() { return players[this.team].turnActions },\r\n  };\r\n\r\n  var enemyPlayer = {\r\n    get team() { return currentPlayer.team === \"teamWhite\" ? \"teamBlack\" : \"teamWhite\" },\r\n    get player() { return players[currentPlayer.team === \"teamWhite\" ? \"teamBlack\" : \"teamWhite\"].player },\r\n    get army() { return players[currentPlayer.team === \"teamWhite\" ? \"teamBlack\" : \"teamWhite\"].armyStats }\r\n  }\r\n\r\n  //Action managers  \r\n  var mapActionManager = new BABYLON.ActionManager(scene);\r\n  var moveActionManager = new BABYLON.ActionManager(scene);\r\n  var teamBlackActionManager = new BABYLON.ActionManager(scene);\r\n  var teamWhiteActionManager = new BABYLON.ActionManager(scene);\r\n\r\n  var actionToken;\r\n\r\n  const importActionTokens = () => {\r\n    BABYLON.SceneLoader.ImportMesh(\r\n      \"\",\r\n      `.${publicURL}/Models/`,\r\n      \"token.babylon\",\r\n      scene,\r\n      function (newMeshes) {\r\n        actionToken = BABYLON.Mesh.MergeMeshes(newMeshes);\r\n        actionToken.position = new BABYLON.Vector3(150, -18, 440);\r\n        actionToken.scaling = new BABYLON.Vector3(800, 900, 800);\r\n        actionToken.name = \"token\"\r\n        actionToken.id = \"token1\"\r\n        actionToken.material = currentPlayer.team === \"teamWhite\" ? tokenMaterialWhite : tokenMaterialBlack;\r\n\r\n        var dx = actionToken.position.x;\r\n        var NB_CLONES = currentPlayer.startActions - 1;\r\n        var actionClone;\r\n        for (var nbclone = 0; nbclone < NB_CLONES; nbclone++) {\r\n          actionClone = actionToken.clone(`token${nbclone + 2}`);\r\n          actionClone.name = \"token\";\r\n          let randomX = Math.floor(Math.random() * 40) + 50;\r\n          actionClone.position.x = dx - randomX;\r\n          actionClone.position.z = actionToken.position.z + Math.floor(Math.random() * 30) - 15;\r\n          dx = dx - randomX;\r\n        };\r\n        players[currentPlayer.team].turnActions = players[currentPlayer.team].startActions;\r\n      }\r\n    );\r\n  }\r\n  importActionTokens();\r\n\r\n  var dice1;\r\n  var dice2;\r\n  var dice3;\r\n  var dice4;\r\n  var dice5;\r\n  var dice6;\r\n  var dice = [];\r\n  BABYLON.SceneLoader.ImportMesh(\r\n    \"\",\r\n    `.${publicURL}/Models/`,\r\n    \"dice.babylon\",\r\n    scene,\r\n    function (newMeshes) {\r\n      dice1 = BABYLON.Mesh.MergeMeshes(newMeshes);\r\n      dice1.scaling = new BABYLON.Vector3(20, 20, 20);\r\n      dice1.translate(BABYLON.Axis.Y, 30, scene);\r\n      dice1.translate(BABYLON.Axis.X, 175, scene);\r\n      dice1.translate(BABYLON.Axis.Z, 50, scene);\r\n      shadowGenerator.getShadowMap().renderList.push(dice1);\r\n      dice1.id = \"dice1\";\r\n      dice1.name = \"dice\";\r\n      dice1.checkCollisions = true;\r\n      dice1.collisionGroup = 1;\r\n      dice1.collisionMask = 1;\r\n\r\n      dice1.setEnabled(false);\r\n      dice.push(dice1);\r\n    }\r\n  );\r\n\r\n  BABYLON.SceneLoader.ImportMesh(\r\n    \"\",\r\n    `.${publicURL}/Models/`,\r\n    \"dice2.babylon\",\r\n    scene,\r\n    function (newMeshes) {\r\n      dice2 = BABYLON.Mesh.MergeMeshes(newMeshes);\r\n      dice2.scaling = new BABYLON.Vector3(20, 20, 20);\r\n      dice2.translate(BABYLON.Axis.Y, 33, scene);\r\n      dice2.translate(BABYLON.Axis.X, 175, scene);\r\n      dice2.translate(BABYLON.Axis.Z, 50, scene);\r\n      shadowGenerator.getShadowMap().renderList.push(dice2);\r\n      dice2.id = \"dice2\";\r\n      dice2.name = \"dice\";\r\n      dice2.checkCollisions = true;\r\n      dice2.collisionGroup = 1;\r\n      dice2.collisionMask = 1;\r\n\r\n      dice2.setEnabled(false);\r\n      dice.push(dice2);\r\n    }\r\n  );\r\n\r\n  BABYLON.SceneLoader.ImportMesh(\r\n    \"\",\r\n    `.${publicURL}/Models/`,\r\n    \"dice3.babylon\",\r\n    scene,\r\n    function (newMeshes) {\r\n      dice3 = BABYLON.Mesh.MergeMeshes(newMeshes);\r\n      dice3.scaling = new BABYLON.Vector3(20, 20, 20);\r\n      dice3.translate(BABYLON.Axis.Y, 33, scene);\r\n      dice3.translate(BABYLON.Axis.X, 175, scene);\r\n      dice3.translate(BABYLON.Axis.Z, 50, scene);\r\n      shadowGenerator.getShadowMap().renderList.push(dice3);\r\n      dice3.id = \"dice3\";\r\n      dice3.name = \"dice\";\r\n      dice3.checkCollisions = true;\r\n      dice3.collisionGroup = 1;\r\n      dice3.collisionMask = 1;\r\n\r\n      dice3.setEnabled(false);\r\n      dice.push(dice3);\r\n    }\r\n  );\r\n\r\n  BABYLON.SceneLoader.ImportMesh(\r\n    \"\",\r\n    `.${publicURL}/Models/`,\r\n    \"dice4.babylon\",\r\n    scene,\r\n    function (newMeshes) {\r\n      dice4 = BABYLON.Mesh.MergeMeshes(newMeshes);\r\n      dice4.scaling = new BABYLON.Vector3(20, 20, 20);\r\n      dice4.translate(BABYLON.Axis.Y, 33, scene);\r\n      dice4.translate(BABYLON.Axis.X, 175, scene);\r\n      dice4.translate(BABYLON.Axis.Z, 50, scene);\r\n      shadowGenerator.getShadowMap().renderList.push(dice4);\r\n      dice4.id = \"dice4\";\r\n      dice4.name = \"dice\";\r\n      dice4.checkCollisions = true;\r\n      dice4.collisionGroup = 1;\r\n      dice4.collisionMask = 1;\r\n\r\n      dice4.setEnabled(false);\r\n      dice.push(dice4);\r\n    }\r\n  );\r\n\r\n  BABYLON.SceneLoader.ImportMesh(\r\n    \"\",\r\n    `.${publicURL}/Models/`,\r\n    \"dice5.babylon\",\r\n    scene,\r\n    function (newMeshes) {\r\n      dice5 = BABYLON.Mesh.MergeMeshes(newMeshes);\r\n      dice5.scaling = new BABYLON.Vector3(20, 20, 20);\r\n      dice5.translate(BABYLON.Axis.Y, 33, scene);\r\n      dice5.translate(BABYLON.Axis.X, 175, scene);\r\n      dice5.translate(BABYLON.Axis.Z, 50, scene);\r\n      shadowGenerator.getShadowMap().renderList.push(dice5);\r\n      dice5.id = \"dice5\";\r\n      dice5.name = \"dice\";\r\n      dice5.checkCollisions = true;\r\n      dice5.collisionGroup = 1;\r\n      dice5.collisionMask = 1;\r\n\r\n      dice5.setEnabled(false);\r\n      dice.push(dice5);\r\n    }\r\n  );\r\n\r\n  BABYLON.SceneLoader.ImportMesh(\r\n    \"\",\r\n    `.${publicURL}/Models/`,\r\n    \"dice6.babylon\",\r\n    scene,\r\n    function (newMeshes) {\r\n      dice6 = BABYLON.Mesh.MergeMeshes(newMeshes);\r\n      dice6.scaling = new BABYLON.Vector3(20, 20, 20);\r\n      dice6.translate(BABYLON.Axis.Y, 33, scene);\r\n      dice6.translate(BABYLON.Axis.X, 175, scene);\r\n      dice6.translate(BABYLON.Axis.Z, 50, scene);\r\n      dice6.rotate(BABYLON.Axis.Y, BABYLON.Tools.ToRadians(90), scene);\r\n      shadowGenerator.getShadowMap().renderList.push(dice6);\r\n      dice6.id = \"dice6\";\r\n      dice6.name = \"dice\";\r\n      dice6.checkCollisions = true;\r\n      dice6.collisionGroup = 1;\r\n      dice6.collisionMask = 1;\r\n\r\n      dice6.setEnabled(false);\r\n      dice.push(dice6);\r\n    }\r\n  );\r\n\r\n  var miniWidth = 25.25;\r\n\r\n  var LOS = BABYLON.MeshBuilder.CreateCylinder(\"lineOfSights\", { height: 0.1, diameter: 202 * 2 + miniWidth, tessellation: 256 }, scene);\r\n  LOS.position = new BABYLON.Vector3(0, -100, 0);\r\n  var LOSM = BABYLON.MeshBuilder.CreateCylinder(\"lineOfSightm\", { height: 0.1, diameter: 404 * 2 + miniWidth, tessellation: 256 }, scene);\r\n  var LOSL = BABYLON.MeshBuilder.CreateCylinder(\"lineOfSightl\", { height: 0.1, diameter: 808 * 2 + miniWidth, tessellation: 256 }, scene);\r\n  //var LOSXL = BABYLON.MeshBuilder.CreateCylinder(\"lineOfSight\", { height: 0.1, diameter: players[currentPlayer.team].armyStats.units.soldier.maxRange * 2 + miniWidth, tessellation: 256 }, scene);\r\n  /*LOSXL.parent =*/ LOSL.parent = LOSM.parent = LOS;\r\n\r\n  var los = BABYLON.CSG.FromMesh(LOS);\r\n  var losM = BABYLON.CSG.FromMesh(LOSM);\r\n  var losL = BABYLON.CSG.FromMesh(LOSL);\r\n  //var losXL = BABYLON.CSG.FromMesh(LOSXL);\r\n\r\n  var slicer = BABYLON.MeshBuilder.CreateBox(\"LOSTemplate\", { width: players[currentPlayer.team].armyStats.units.soldier.maxRange * 2, height: 2500, depth: 1 }, scene);\r\n  slicer.rotate(BABYLON.Axis.X, BABYLON.Tools.ToRadians(90), scene);\r\n  slicer.position = new BABYLON.Vector3(players[currentPlayer.team].armyStats.units.soldier.maxRange, -100, 0);\r\n  slicer.visibility = 0;\r\n  var slicerCSG = BABYLON.CSG.FromMesh(slicer);\r\n\r\n  //losXL = losXL.subtract(slicerCSG).subtract(losL).subtract(losM).subtract(los);\r\n\r\n  losL = losL.subtract(slicerCSG).subtract(losM).subtract(los);\r\n\r\n  losM = losM.subtract(slicerCSG).subtract(los);\r\n\r\n  los = los.subtract(slicerCSG);\r\n\r\n  var lineOfSight = los.toMesh(\"lineOfSightS\");\r\n  var lineOfSightM = losM.toMesh(\"lineOfSightM\");\r\n  var lineOfSightL = losL.toMesh(\"lineOfSightL\");\r\n  //var lineOfSightXL = losXL.toMesh(\"lineOfSight\");\r\n\r\n  /*lineOfSightXL.parent =*/ lineOfSightL.parent = lineOfSightM.parent = lineOfSight;\r\n  /*lineOfSightXL.isPickable =*/ lineOfSightL.isPickable = lineOfSightM.isPickable = lineOfSight.isPickable = false;\r\n\r\n  lineOfSight.setEnabled(false);\r\n  slicer.dispose();\r\n  LOS.dispose();\r\n  LOSM.dispose();\r\n  LOSL.dispose();\r\n  //LOSXL.dispose();\r\n\r\n\r\n  const getLosColor = (unit, team, range) => {\r\n    var losColorBad = new BABYLON.Color3(164 / 255, 27 / 255, 7 / 255); //red\r\n    var losColorMalus = new BABYLON.Color3(215 / 255, 195 / 255, 58 / 255); //yellow\r\n    var losColorZero = new BABYLON.Color3(7 / 255, 66 / 255, 164 / 255); //blue\r\n    var losColorBonus = new BABYLON.Color3(7 / 255, 164 / 255, 27 / 255); //green\r\n\r\n    if (players[team].armyStats.units[unit].range.mods[range] > 0) {\r\n      return losColorBonus;\r\n    } else if (players[team].armyStats.units[unit].range.mods[range] === 0) {\r\n      return losColorZero;\r\n    } else if (players[team].armyStats.units[unit].range.mods[range] === -1) {\r\n      return losColorMalus;\r\n    } else if (players[team].armyStats.units[unit].range.mods[range] <= -2) {\r\n      return losColorBad;\r\n    }\r\n  }\r\n\r\n  const getHeight = (mesh) => {\r\n    return mesh.getBoundingInfo().boundingBox.extendSize.y * 2 * mesh.scaling.y\r\n  };\r\n\r\n  const getWidth = (mesh) => {\r\n    return mesh.getBoundingInfo().boundingBox.extendSize.x * 2 * mesh.scaling.x\r\n  };\r\n\r\n  const getLength = (mesh) => {\r\n    return mesh.getBoundingInfo().boundingBox.extendSize.z * 2 * mesh.scaling.z\r\n  };\r\n\r\n  const getControlByName = (name) => {\r\n    return advancedTexture._rootContainer._children.filter(control => control.name === name)[0]\r\n  }\r\n\r\n  async function asyncForEach(array, callback) {\r\n    for (let index = 0; index < array.length; index++) {\r\n      await callback(array[index], index, array);\r\n    }\r\n  }\r\n\r\n  var shield;\r\n  BABYLON.SceneLoader.ImportMesh(\r\n    \"\",\r\n    `.${publicURL}/Models/`,\r\n    \"shield.babylon\",\r\n    scene,\r\n    function (newMeshes) {\r\n      shield = BABYLON.Mesh.MergeMeshes(newMeshes);\r\n      shield.scaling = new BABYLON.Vector3(6, 5, 10);\r\n      shield.translate(BABYLON.Axis.Y, 80, scene);\r\n      shadowGenerator.getShadowMap().renderList.push(shield);\r\n      shield.id = \"shield\";\r\n      shield.name = \"shield\";\r\n\r\n      shield.setEnabled(false);\r\n    }\r\n  );\r\n\r\n  /*const createTextPlane = (mini) => {\r\n    let miniPlane = new BABYLON.Mesh.CreatePlane(`${mini.id}TextPlane`, 150, scene, true);\r\n    miniPlane.material = new BABYLON.StandardMaterial(`${mini.id}TextMat`, scene);\r\n    miniPlane.material.diffuseTexture = new BABYLON.DynamicTexture(`${mini.id}DynamicTexture`, { width: 100, height: 100 }, scene);\r\n    miniPlane.material.diffuseTexture.hasAlpha = true;\r\n    miniPlane.position = new BABYLON.Vector3(0, 40, 0);\r\n    miniPlane.parent = mini;\r\n    return miniPlane;\r\n  };*/\r\n\r\n  const createBase = (mini, team) => {\r\n    let base = BABYLON.MeshBuilder.CreateCylinder(`${mini.id}Base`, { height: 2.5, diameter: 27, tessellation: 128 }, scene);\r\n    base.material = new BABYLON.StandardMaterial(`baseMaterial${mini.id}`, scene);\r\n    base.material.diffuseColor = team === \"Black\" ? new BABYLON.Color3.Black() : new BABYLON.Color3.White();\r\n    base.position = new BABYLON.Vector3(0, 1.5, 0);\r\n    base.parent = mini;\r\n    return base;\r\n  };\r\n\r\n  const createLOS = (mini, team) => {\r\n    var miniLOS = lineOfSight.clone();\r\n    miniLOS.id = `${mini.id}lineOfSight`;\r\n    miniLOS.name = `${mini.id}lineOfSight`;\r\n    miniLOS.parent = mini;\r\n    miniLOS.position = new BABYLON.Vector3(0, 1, 0);\r\n    miniLOS.rotation.y = BABYLON.Tools.ToRadians(-90);\r\n    miniLOS.setEnabled(false);\r\n    miniLOS.material = team === \"Black\" ? lineOfSightMatB : lineOfSightMatW;\r\n    miniLOS._children[0].material = team === \"Black\" ? lineOfSightMMatB : lineOfSightMMatW;\r\n    miniLOS._children[1].material = team === \"Black\" ? lineOfSightLMatB : lineOfSightLMatW;\r\n    //miniLOS._children[2].material = team === \"Black\" ? lineOfSightXLMatB : lineOfSightXLMatW;\r\n    if (team === \"Black\") {\r\n      mini.losMat = [lineOfSightMatB.name, lineOfSightMMatB.name, lineOfSightLMatB.name, lineOfSightXLMatB.name]\r\n      lineOfSightMatB.diffuseColor = getLosColor(mini.unit, `team${team}`, \"s\"); //blue\r\n      lineOfSightMMatB.diffuseColor = getLosColor(mini.unit, `team${team}`, \"m\"); //green\r\n      lineOfSightLMatB.diffuseColor = getLosColor(mini.unit, `team${team}`, \"l\"); //yellow\r\n      //lineOfSightXLMatB.diffuseColor = getLosColor(mini.unit, `team${team}`, \"xl\"); //yellow  \r\n    } else {\r\n      mini.losMat = [lineOfSightMatW.name, lineOfSightMMatW.name, lineOfSightLMatW.name, lineOfSightXLMatW.name]\r\n      lineOfSightMatW.diffuseColor = getLosColor(mini.unit, `team${team}`, \"s\"); //blue\r\n      lineOfSightMMatW.diffuseColor = getLosColor(mini.unit, `team${team}`, \"m\"); //green\r\n      lineOfSightLMatW.diffuseColor = getLosColor(mini.unit, `team${team}`, \"l\"); //yellow\r\n      //lineOfSightXLMatW.diffuseColor = getLosColor(mini.unit, `team${team}`, \"xl\"); //yellow\r\n    }\r\n    return miniLOS;\r\n  };\r\n\r\n  const createShield = (mini, team) => {\r\n    let miniShield = shield.clone(`${mini.id}shield`);\r\n    miniShield.material = new BABYLON.StandardMaterial(`shieldMaterial${mini.id}`, scene);\r\n    miniShield.material.diffuseColor = team === \"Black\" ? new BABYLON.Color3.Black() : new BABYLON.Color3.White();\r\n    miniShield.parent = mini;\r\n    miniShield.position = new BABYLON.Vector3(0, 55, 0);\r\n    miniShield.setEnabled(false);\r\n    return miniShield;\r\n  }\r\n  var clonedMini;\r\n  //STLRW\r\n  const importMiniModel = (miniName, team, index) => {\r\n    BABYLON.SceneLoader.ImportMesh(\r\n      \"\",\r\n      `.${publicURL}/Models/`,\r\n      `${miniName}.babylon`,\r\n      scene,\r\n      function (newMeshes) {\r\n        let mini = BABYLON.Mesh.MergeMeshes(newMeshes);\r\n        mini.translate(BABYLON.Axis.Y, 25, scene);\r\n        mini.translate(BABYLON.Axis.X, team === \"Black\" ? -300 : 300, scene);\r\n        mini.translate(BABYLON.Axis.Z, -200 + 200 * index, scene);\r\n        mini.name = `${team.toLowerCase()}Mini`;\r\n        mini.id = `${team.toLowerCase()}Mini${index + 1}`;\r\n        mini.unit = \"soldier\";\r\n        mini.team = `team${team}`;\r\n        mini.rotation.y = team === \"Black\" ? BABYLON.Tools.ToRadians(-90) : BABYLON.Tools.ToRadians(90);\r\n        mini.material = miniMaterial;\r\n        mini.actionManager = team === \"Black\" ? teamBlackActionManager : teamWhiteActionManager;\r\n        mini.enablePointerMoveEvents = true;\r\n\r\n        mini.width = getWidth(mini);\r\n        mini.height = getHeight(mini);\r\n\r\n        createBase(mini, team);\r\n        createLOS(mini, team);\r\n        createShield(mini, team);\r\n        //createTextPlane(mini);\r\n\r\n        shadowGenerator.getShadowMap().renderList.push(mini);\r\n        players[`team${team}`].minis.push(mini);\r\n        if (players.teamWhite.minis && players.teamWhite.minis.length > 1) {\r\n          camera.setTarget(players.teamWhite.minis[1]);\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  const importAllModels = () => {\r\n    players.teamBlack.units.forEach((miniName, index) => importMiniModel(miniName, \"Black\", index))\r\n    players.teamWhite.units.forEach((miniName, index) => importMiniModel(miniName, \"White\", index))\r\n  }\r\n  importAllModels();\r\n\r\n  var obstacles = [];\r\n  BABYLON.SceneLoader.ImportMesh(\r\n    \"\",\r\n    `.${publicURL}/Models/`,\r\n    \"container.babylon\",\r\n    scene,\r\n    function (newMeshes) {\r\n      var container = BABYLON.Mesh.MergeMeshes(newMeshes);\r\n\r\n      //container.material = diceMaterial;\r\n      container.scaling = new BABYLON.Vector3(2, 2, 2);\r\n      container.id = \"obstacle1\";\r\n      container.name = \"obstacle\";\r\n      container.receiveShadows = true;\r\n\r\n      container.width = getWidth(container);\r\n      container.length = getLength(container);\r\n      container.height = getHeight(container);\r\n\r\n      var redMat = new BABYLON.StandardMaterial(scene);\r\n      redMat.diffuseColor = new BABYLON.Color3(0.518, 0.271, 0.267);\r\n\r\n      var greyMat = new BABYLON.StandardMaterial(scene);\r\n      greyMat.diffuseColor = new BABYLON.Color3(0.671, 0.663, 0.733);\r\n\r\n      var greenMat = new BABYLON.StandardMaterial(scene);\r\n      greenMat.diffuseColor = new BABYLON.Color3(0.318, 0.502, 0.43);\r\n\r\n      var container0 = container.clone(\"obstacle\")\r\n      container0.position = new BABYLON.Vector3(22, 0, 2.5);\r\n      var container2 = container.clone(\"obstacle\")\r\n      container2.position = new BABYLON.Vector3(-22, 0, 2.5);\r\n\r\n      var container02 = BABYLON.Mesh.MergeMeshes([container0, container2]);\r\n      container02.material = redMat;\r\n      container02.name = container02.id = \"obstacle\";\r\n      container02.position = new BABYLON.Vector3(180, 50, 125);\r\n      container0.dispose();\r\n      container2.dispose();\r\n\r\n      var container3 = container.clone(\"obstacle\")\r\n      container3.position = new BABYLON.Vector3(100, 50, -125);\r\n      container3.material = redMat;\r\n\r\n      var container4 = container.clone(\"obstacle\")\r\n      container4.position = new BABYLON.Vector3(150, 50, -125);\r\n\r\n      var container5 = container.clone(\"obstacle\")\r\n      container5.position = new BABYLON.Vector3(-100, 50, 125);\r\n\r\n      var container6 = container.clone(\"obstacle\")\r\n      container6.position = new BABYLON.Vector3(-150, 50, 125);\r\n      container6.material = redMat;\r\n\r\n      var container7 = container.clone(\"obstacle\")\r\n      container7.position = new BABYLON.Vector3(22, 0, 2.5);\r\n\r\n      var container8 = container.clone(\"obstacle\")\r\n      container8.position = new BABYLON.Vector3(-22, 0, 2.5);\r\n\r\n      var container78 = BABYLON.Mesh.MergeMeshes([container7, container8]);\r\n      container78.material = greenMat;\r\n      container78.name = container78.id = \"obstacle\";\r\n      container78.position = new BABYLON.Vector3(-180, 50, -125);\r\n      container7.dispose();\r\n      container8.dispose();\r\n\r\n      var container9 = container.clone(\"obstacle\")\r\n      container9.position = new BABYLON.Vector3(-180, 100, -150);\r\n      container9.scaling.z = 1;\r\n\r\n      var container10 = container.clone(\"obstacle\")\r\n      container10.position = new BABYLON.Vector3(180, 100, 100);\r\n      container10.scaling.z = 1;\r\n      container10.material = greyMat;\r\n\r\n      var container11 = container.clone(\"obstacle\")\r\n      container11.position = new BABYLON.Vector3(250, 38, 150);\r\n      container11.scaling.z = 1;\r\n      container11.scaling.y = 1;\r\n      container11.material = greenMat;\r\n\r\n      var container12 = container.clone(\"obstacle\")\r\n      container12.position = new BABYLON.Vector3(-250, 38, -100);\r\n      container12.scaling.z = 1;\r\n      container12.scaling.y = 1;\r\n      container12.material = redMat;\r\n\r\n      shadowGenerator.getShadowMap().renderList.push(container02, container3, container4, container5, container6, container78, container9, container10, container11, container12);\r\n      obstacles.push(container02, container3, container4, container5, container6, container78, container9, container10, container11, container12);\r\n\r\n      container.setEnabled(false);\r\n    }\r\n  );\r\n\r\n  var moveArea = BABYLON.MeshBuilder.CreateCylinder(\"moveArea\", { height: 0.25, diameter: miniWidth * 8, tessellation: 256 }, scene);\r\n  moveArea.material = invisibleMaterial;\r\n  moveArea.actionManager = moveActionManager;\r\n  moveArea.setEnabled(false);\r\n  moveArea.position = new BABYLON.Vector3(0, 26, 0);\r\n\r\n  var moveArea2 = BABYLON.MeshBuilder.CreateCylinder(\"moveArea\", { height: 0.25, diameter: miniWidth * 8 + miniWidth, tessellation: 256 }, scene);\r\n  moveArea2.material = moveAreaMat;\r\n  moveArea2.parent = moveArea;\r\n\r\n  var board;\r\n  var map;\r\n  BABYLON.SceneLoader.ImportMesh(\r\n    \"\",\r\n    \"\",\r\n    `.${publicURL}/Models/setting.babylon`,\r\n    scene,\r\n    function (newMeshes) {\r\n      board = newMeshes[0];\r\n      board.scaling = new BABYLON.Vector3(1150, 1200, 1000);\r\n      board.material = boardMaterial;\r\n      shadowGenerator.getShadowMap().renderList.push(board);\r\n\r\n      map = BABYLON.MeshBuilder.CreateBox(\"map\", { width: 808, height: 606, depth: 1 }, scene);\r\n      map.rotate(BABYLON.Axis.X, BABYLON.Tools.ToRadians(90), scene);\r\n      map.material = groundMaterial;\r\n      map.receiveShadows = true;\r\n      map.translate(BABYLON.Axis.Y, 25, scene);\r\n      map.actionManager = mapActionManager;\r\n    }\r\n  );\r\n  //board is 24 inch to 32 inch;\r\n\r\n  //Should import action tokens after switching Player\r\n  var switchPlayer = () => {\r\n    if (currentPlayer.team === \"teamWhite\") {\r\n      currentPlayer.team = \"teamBlack\";\r\n      camera.position = new BABYLON.Vector3(-700, 300, 0);\r\n      targetFurthestMini();\r\n    } else if (currentPlayer.team === \"teamBlack\") {\r\n      currentPlayer.team = \"teamWhite\";\r\n      camera.position = new BABYLON.Vector3(700, 300, 0);\r\n      targetFurthestMini();\r\n    }\r\n    importActionTokens();\r\n  };\r\n\r\n  //Mini selected by player1;\r\n  var selected = \"\";\r\n  var targets = [];\r\n  var inAttack = false;\r\n  var rotate = false;\r\n  var previous = {\r\n    position: null,\r\n    rotation: null\r\n  };\r\n\r\n  const cancelTargeting = () => {\r\n    targets.forEach(target => {\r\n      hl.removeMesh(target);\r\n      if (scene.getMeshByName(`${selected.id}To${target.id}`)) {\r\n        scene.removeMesh(scene.getMeshByName(`${selected.id}To${target.id}`));\r\n      }\r\n    });\r\n    targets = [];\r\n    if (scene.getMeshByName(\"directLOS\")) {\r\n      scene.getMeshByName(\"directLOS\").dispose();\r\n    }\r\n    players[enemyPlayer.team].minis.forEach(mini => {\r\n      if (scene.getMeshByName(`${mini.id}To${selected.id}`)) {\r\n        scene.removeMesh(scene.getMeshByName(`${mini.id}To${selected.id}`));\r\n      }\r\n      removeDiceStat(mini);\r\n      mini.diceAssigned = 0;\r\n    })\r\n    advancedTexture.removeControl(rollButton);\r\n  }\r\n\r\n  var selection = function (evt) {\r\n    //left click\r\n    if (evt.sourceEvent.which === 1) {\r\n      let currentMesh = evt.meshUnderPointer;\r\n      scene.hoverCursor = \"pointer\";\r\n      if (selected === currentMesh) {\r\n        if (targets.length === 0) {\r\n          moveAction({ skip: true });\r\n        }\r\n        //camera.setTarget(board);\r\n      } else if (currentMesh.name.includes(\"Mini\")) {\r\n        if (selected) {\r\n          hl.removeMesh(selected);\r\n        }\r\n        if (currentPlayer.turnActions > 0) {\r\n          cancelTargeting();\r\n          hl.addMesh(currentMesh, BABYLON.Color3.White());\r\n          hl.addMesh(moveArea, BABYLON.Color3.White());\r\n          selected = currentMesh;\r\n          previous.position = selected.position;\r\n          moveArea.position = new BABYLON.Vector3(currentMesh.position.x, 26, currentMesh.position.z)\r\n          moveArea.setEnabled(true);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  var cancelSelection = () => {\r\n    if (selected && rotate && !inAttack) {\r\n      if (previous.position) {\r\n        selected.position = previous.position;\r\n        selected.rotation = previous.rotation;\r\n        moveArea.setEnabled(true);\r\n        moveArea.position = new BABYLON.Vector3(previous.position.x, 26, previous.position.z);\r\n        scene.getMeshByName(`${selected.id}lineOfSight`).setEnabled(false);\r\n        if (scene.getMeshByName(`groundLOS${selected.id}`)) {\r\n          scene.getMeshByName(`groundLOS${selected.id}`).setEnabled(false);\r\n        }\r\n      }\r\n      canvas.removeEventListener(\"mousemove\", rotateOnMouseMove);\r\n      rotate = false;\r\n    } else if (selected && !rotate) {\r\n      moveArea.setEnabled(false);\r\n      hl.removeMesh(selected);\r\n      hl.removeMesh(moveArea);\r\n      cancelTargeting();\r\n      scene.removeMesh(clonedMini);\r\n      scene.getMeshByName(`${selected.id}lineOfSight`).setEnabled(false);\r\n      if (scene.getMeshByName(`groundLOS${selected.id}`)) {\r\n        scene.getMeshByName(`groundLOS${selected.id}`).setEnabled(false);\r\n      }\r\n      targetFurthestMini();\r\n      selected = \"\";\r\n      scene.hoverCursor = \"pointer\";\r\n      if (clonedMini) {\r\n        clonedMini.dispose();\r\n      }\r\n    }\r\n  }\r\n\r\n  const noObstacle = (mini1, mini2) => {\r\n    let origin = new BABYLON.Vector3(mini1.position.x, mini1.position.y + getHeight(mini1) * 0.75, mini1.position.z);\r\n\r\n    let targetLeft = new BABYLON.Vector3(mini2.position.x, mini2.position.y + getHeight(mini2) * 0.75, mini2.position.z - mini2.width / 2 + mini2.width * 0.25);\r\n    let targetRight = new BABYLON.Vector3(mini2.position.x, mini2.position.y + getHeight(mini2) * 0.75, mini2.position.z + mini2.width / 2 - mini2.width * 0.25);\r\n\r\n    let directionLeft = targetLeft.subtract(origin);\r\n    directionLeft = BABYLON.Vector3.Normalize(directionLeft);\r\n\r\n    let directionRight = targetRight.subtract(origin);\r\n    directionRight = BABYLON.Vector3.Normalize(directionRight);\r\n\r\n    let length = BABYLON.Vector3.Distance(mini1.position, mini2.position) - getWidth(mini2) / 2;\r\n\r\n    let rayLeft = new BABYLON.Ray(origin, directionLeft, length);\r\n    let rayRight = new BABYLON.Ray(origin, directionRight, length);\r\n\r\n    //let rayHelperLeft = new BABYLON.RayHelper(rayLeft);\r\n    //let rayHelperRight = new BABYLON.RayHelper(rayRight);\r\n    //rayHelperLeft.show(scene);\r\n    //rayHelperRight.show(scene);\r\n\r\n    let hitsLeft = scene.multiPickWithRay(rayLeft);\r\n    let hitsRight = scene.multiPickWithRay(rayRight);\r\n\r\n    if (hitsLeft.some(hit => hit.pickedMesh.name.includes(\"obstacle\")) && hitsRight.some(hit => hit.pickedMesh.name.includes(\"obstacle\"))) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    }\r\n  }\r\n\r\n  const isInCover = (mini1, mini2) => {\r\n    let originLeft = new BABYLON.Vector3(mini1.position.x, mini1.position.y + 5, mini1.position.z - mini1.width / 2);\r\n    let originRight = new BABYLON.Vector3(mini1.position.x, mini1.position.y + 5, mini1.position.z + mini1.width / 2);\r\n\r\n    let target = new BABYLON.Vector3(mini2.position.x, mini2.position.y + 5, mini2.position.z);\r\n\r\n    let directionLeft = target.subtract(originLeft);\r\n    directionLeft = BABYLON.Vector3.Normalize(directionLeft);\r\n\r\n    let directionRight = target.subtract(originRight);\r\n    directionRight = BABYLON.Vector3.Normalize(directionRight);\r\n\r\n    let length = getWidth(mini1) / 2 + getWidth(mini1);\r\n\r\n    let rayLeft = new BABYLON.Ray(originLeft, directionLeft, length);\r\n    let rayRight = new BABYLON.Ray(originRight, directionRight, length);\r\n\r\n    //let rayHelperLeft = new BABYLON.RayHelper(rayLeft);\r\n    //let rayHelperRight = new BABYLON.RayHelper(rayRight);\r\n    //rayHelperLeft.show(scene);\r\n    //rayHelperRight.show(scene);\r\n\r\n    let hitsLeft = scene.multiPickWithRay(rayLeft);\r\n    let hitsRight = scene.multiPickWithRay(rayRight);\r\n\r\n    if (hitsLeft.some(hit => hit.pickedMesh.name.includes(\"obstacle\"))) {\r\n      return true;\r\n    } else if (hitsRight.some(hit => hit.pickedMesh.name.includes(\"obstacle\"))) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  const isInAngle = (mini1, mini2) => {\r\n    //Check here if angle forward and target < 90deg\r\n    let forward = forwardDirection(mini1);\r\n\r\n    let origin = new BABYLON.Vector3(mini1.position.x, 55, mini1.position.z);\r\n\r\n    let target = new BABYLON.Vector3(mini2.position.x, 55, mini2.position.z);\r\n\r\n    let directionTarget = target.subtract(origin);\r\n    directionTarget = BABYLON.Vector3.Normalize(directionTarget);\r\n\r\n    if (Math.acos(BABYLON.Vector3.Dot(forward, directionTarget)) * 180 / Math.PI > 90) {\r\n      return false;\r\n    } else {\r\n      return true;\r\n    };\r\n  };\r\n\r\n  const isHigher = (mini1, mini2) => {\r\n    if (mini1.position.y > mini2.position.y + getHeight(mini2)) {\r\n      return true;\r\n    } else {\r\n      return false;\r\n    };\r\n  };\r\n\r\n  const whatIsUnderneath = (mini) => {\r\n    let origin = new BABYLON.Vector3(mini.position.x, mini.position.y, mini.position.z + getWidth(mini) / 2);\r\n    let origin2 = new BABYLON.Vector3(mini.position.x, mini.position.y, mini.position.z - getWidth(mini) / 2);\r\n    let origin3 = new BABYLON.Vector3(mini.position.x + getWidth(mini) / 2, mini.position.y, mini.position.z);\r\n    let origin4 = new BABYLON.Vector3(mini.position.x - getWidth(mini) / 2, mini.position.y, mini.position.z);\r\n\r\n    let direction = new BABYLON.Vector3(0, -1, 0);\r\n\r\n    let length = getHeight(mini) / 2;\r\n\r\n    let ray = new BABYLON.Ray(origin, direction, length);\r\n    let ray2 = new BABYLON.Ray(origin2, direction, length);\r\n    let ray3 = new BABYLON.Ray(origin3, direction, length);\r\n    let ray4 = new BABYLON.Ray(origin4, direction, length);\r\n\r\n    let hits = scene.multiPickWithRay(ray);\r\n    let hits2 = scene.multiPickWithRay(ray2);\r\n    let hits3 = scene.multiPickWithRay(ray3);\r\n    let hits4 = scene.multiPickWithRay(ray4);\r\n\r\n    if (hits.some(hit => hit.pickedMesh.name.includes(\"obstacle\"))) {\r\n      return hits.filter(hit => hit.pickedMesh.name.includes(\"obstacle\")).map(hit => hit.pickedMesh)[0]\r\n    } else if (hits2.some(hit => hit.pickedMesh.name.includes(\"obstacle\"))) {\r\n      return hits2.filter(hit => hit.pickedMesh.name.includes(\"obstacle\")).map(hit => hit.pickedMesh)[0]\r\n    } else if (hits3.some(hit => hit.pickedMesh.name.includes(\"obstacle\"))) {\r\n      return hits3.filter(hit => hit.pickedMesh.name.includes(\"obstacle\")).map(hit => hit.pickedMesh)[0]\r\n    } else if (hits4.some(hit => hit.pickedMesh.name.includes(\"obstacle\"))) {\r\n      return hits4.filter(hit => hit.pickedMesh.name.includes(\"obstacle\")).map(hit => hit.pickedMesh)[0]\r\n    } else if (hits.some(hit => hit.pickedMesh.name.includes(\"map\"))) {\r\n      return hits.filter(hit => hit.pickedMesh.name.includes(\"map\")).map(hit => hit.pickedMesh)[0]\r\n    }\r\n  };\r\n\r\n  var handleCoverLogo = (mini1, mini2) => {\r\n    if (isInCover(mini1, mini2)) {\r\n      scene.getMeshByName(`${mini1.id}shield`).setEnabled(true);\r\n    } else {\r\n      if (scene.getMeshByName(`${mini1.id}shield`)) {\r\n        scene.getMeshByName(`${mini1.id}shield`).setEnabled(false);\r\n      }\r\n    }\r\n    if (isInCover(mini2, mini1)) {\r\n      scene.getMeshByName(`${mini2.id}shield`).setEnabled(true);\r\n    } else {\r\n      if (scene.getMeshByName(`${mini2.id}shield`)) {\r\n        scene.getMeshByName(`${mini2.id}shield`).setEnabled(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  var removeCoverLogo = (mini) => {\r\n    if (scene.getMeshByName(`${mini.id}shield`)) {\r\n      scene.getMeshByName(`${mini.id}shield`).setEnabled(false);\r\n    }\r\n  }\r\n\r\n  var handleLineOfSight = (ev) => {\r\n    var enemyTarget = ev.meshUnderPointer;\r\n    if (selected && rangeToTarget(selected, enemyTarget) && calculateSuccess(selected, enemyTarget) <= 6) {\r\n      handleCoverLogo(selected, enemyTarget);\r\n      if (enemyTarget.intersectsMesh(selected, false)) {\r\n        //Melee position\r\n        //scene.hoverCursor = \"url('./Cursors/melee.cur') 10 10, auto\";\r\n\r\n      } else if (rangeToTarget(selected, enemyTarget)) {\r\n        scene.getMeshByName(`${selected.id}lineOfSight`).setEnabled(true)\r\n        if (scene.getMeshByName(`groundLOS${selected.id}`)) {\r\n          scene.getMeshByName(`groundLOS${selected.id}`).setEnabled(true);\r\n        }\r\n        moveArea.setEnabled(false);\r\n\r\n        //In range position\r\n        //scene.hoverCursor = \"url('./Cursors/aim.cur'), auto\";\r\n      } else if (!enemyTarget.intersectsMesh(selected, false) && !rangeToTarget(selected, enemyTarget)) {\r\n        //scene.hoverCursor = \"url('./Cursors/unavailable.cur') 15 15, auto\";\r\n        moveArea.setEnabled(false);\r\n        scene.getMeshByName(`${selected.id}lineOfSight`).setEnabled(true)\r\n        if (scene.getMeshByName(`groundLOS${selected.id}`)) {\r\n          scene.getMeshByName(`groundLOS${selected.id}`).setEnabled(true);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  var cancelLineOfSight = () => {\r\n    if (selected) {\r\n      scene.getMeshByName(`${selected.id}lineOfSight`).setEnabled(false);\r\n      scene.getMeshByName(`${selected.id}shield`).setEnabled(false);\r\n      players[enemyPlayer.team].minis.forEach(mini => scene.getMeshByName(`${mini.id}lineOfSight`).setEnabled(false));\r\n      if (scene.getMeshByName(`groundLOS${selected.id}`)) {\r\n        scene.getMeshByName(`groundLOS${selected.id}`).setEnabled(false);\r\n      }\r\n      if (!rotate && targets.length === 0) {\r\n        moveArea.setEnabled(true);\r\n      }\r\n      removeCoverLogo(selected);\r\n      players[enemyPlayer.team].minis.forEach(mini => {\r\n        removeCoverLogo(mini);\r\n      })\r\n    }\r\n    scene.hoverCursor = \"pointer\";\r\n  }\r\n\r\n  var targetFurthestMini = () => {\r\n    if (players[currentPlayer.team].minis && players[currentPlayer.team].minis.length > 0) {\r\n      var miniPosition = players[currentPlayer.team].minis.map(mini => mini.position.x);\r\n      var furthestMiniIndex = currentPlayer.team === \"teamWhite\" ? miniPosition.indexOf(Math.min(...miniPosition)) : miniPosition.indexOf(Math.max(...miniPosition));\r\n      var furthestMini = players[currentPlayer.team].minis[furthestMiniIndex];\r\n      var furthestTarget = BABYLON.Mesh.CreateSphere(\"targetSphere\", { size: 10 }, scene);\r\n      furthestTarget.setEnabled(false);\r\n      furthestTarget.position = new BABYLON.Vector3(furthestMini.position.x, furthestMini.position.y + 30, 0);\r\n      camera.setTarget(furthestTarget);\r\n      setTimeout(() => {\r\n        furthestTarget.dispose();\r\n      }, 1100)\r\n    }\r\n  };\r\n\r\n  var diceRoll = (rolls) => {\r\n    let arrayResult = [];\r\n    for (let i = 0; i < rolls; i++) {\r\n      arrayResult.push(Math.floor(Math.random() * 6) + 1)\r\n    }\r\n\r\n    return arrayResult;\r\n  }\r\n\r\n  var cloneDice = (rolls, mini, delay, save) => {\r\n    var dicePosition1 = new BABYLON.Vector3(mini.position.x + 10, mini.position.y + 7, mini.position.z + 30)\r\n    var dicePosition2 = new BABYLON.Vector3(mini.position.x + 10, mini.position.y + 7, mini.position.z + 45)\r\n    var dicePosition3 = new BABYLON.Vector3(mini.position.x + -5, mini.position.y + 7, mini.position.z + 30)\r\n    var diceOddPosition3 = new BABYLON.Vector3(mini.position.x + -5, mini.position.y + 7, mini.position.z + 37.5)\r\n\r\n    var dicePosition4 = new BABYLON.Vector3(mini.position.x + -5, mini.position.y + 7, mini.position.z + 45)\r\n    var dicePosition5 = new BABYLON.Vector3(mini.position.x + -20, mini.position.y + 7, mini.position.z + 30)\r\n    var diceOddPosition5 = new BABYLON.Vector3(mini.position.x + -20, mini.position.y + 7, mini.position.z + 37.5)\r\n\r\n    var dicePosition6 = new BABYLON.Vector3(mini.position.x + -20, mini.position.y + 7, mini.position.z + 45)\r\n\r\n    var dicePositions = [dicePosition1, dicePosition2, dicePosition3, dicePosition4, dicePosition5, dicePosition6];\r\n\r\n    for (let i = 0; i < rolls.length; i++) {\r\n      var diceIndex = i + 1\r\n      if (save) {\r\n        dice[rolls[i] - 1].material = diceMatRed;\r\n      } else if (mini.name.includes(\"white\")) {\r\n        dice[rolls[i] - 1].material = diceMatWhite;\r\n      } else if (mini.name.includes(\"black\")) {\r\n        dice[rolls[i] - 1].material = diceMatBlack;\r\n      }\r\n\r\n      if (rolls.length === 3 && diceIndex === 3) {\r\n        dice[rolls[i] - 1].clone(`diceClone${i}`).position = diceOddPosition3;\r\n      } else if (rolls.length === 5 && diceIndex === 5) {\r\n        dice[rolls[i] - 1].clone(`diceClone${i}`).position = diceOddPosition5;\r\n      } else {\r\n        dice[rolls[i] - 1].clone(`diceClone${i}`).position = dicePositions[i];\r\n      }\r\n\r\n      setTimeout(function () {\r\n        scene.removeMesh(scene.getMeshByName(`diceClone${i}`));\r\n      }, delay)\r\n    }\r\n  }\r\n\r\n  var compareRolls = (mini1, mini1Rolls, mini1Mod, mini2, mini2Rolls, mini2Mod) => {\r\n    //check if rolls successful, remove any unsuccessful rolls\r\n    var mini1Success = mini1Rolls.filter(roll => roll + mini1Mod >= players[mini1.team].armyStats.units.soldier.range.success);\r\n    var mini2Success = mini2Rolls.filter(roll => roll + mini2Mod >= players[mini2.team].armyStats.units.soldier.defense.success);\r\n\r\n    console.log(\"Player rolls:\");\r\n    console.log(mini1Rolls);\r\n    console.log(\"He has a \" + mini1Mod + \" modifier to dice roll\");\r\n\r\n\r\n    console.log(\"Enemy rolls:\");\r\n    console.log(mini2Rolls);\r\n    console.log(\"He has a \" + mini2Mod + \" modifier to dice roll\");\r\n\r\n    console.log(\"Player success rolls:\")\r\n    console.log(mini1Success);\r\n\r\n    console.log(\"Enemy Success rolls:\")\r\n    console.log(mini2Success);\r\n\r\n    //check if duplicates, remove duplicates player enemy\r\n    for (let i = 0; i < mini1Success.length; i++) {\r\n      for (let j = 0; j < mini2Success.length; j++) {\r\n        if (mini1Success[i] === mini2Success[j]) {\r\n          mini1Success.splice(i, 1);\r\n          mini2Success.splice(j, 1)\r\n        }\r\n      }\r\n    }\r\n\r\n    if (Math.max(...mini1Success) > Math.max(...mini2Success)) {\r\n      //player with the highest numbers win.   \r\n      console.log(`${mini1.id} wins with a higher roll!`);\r\n      return mini1.name;\r\n    } else if (Math.max(...mini2Success) > Math.max(...mini1Success)) {\r\n      console.log(`${mini2.id} wins with a higher roll!`);\r\n      return mini2.name;\r\n    } else {\r\n      //if no result left or equal, both miss.\r\n      return null\r\n    }\r\n  }\r\n\r\n  var rangeToTarget = (mini1, mini2) => {\r\n    let rangeResult;\r\n\r\n    let distance = BABYLON.Vector3.Distance(mini1.position, mini2.position) - mini2.width / 2;\r\n    let mini1Team = mini1.name === \"whiteMini\" ? \"teamWhite\" : \"teamBlack\";\r\n    let mini1MaxRange = players[mini1Team].armyStats.units[mini1.unit].maxRange\r\n    //close combat if minis base are within 1 inch\r\n    if (distance <= mini1.width / 2 + mini2.width / 2) {\r\n      rangeResult = \"c\";\r\n      //8 inches\r\n    } else if (distance <= 202) {\r\n      rangeResult = \"s\";\r\n      // between 8 and 16 inches\r\n    } else if (distance > 202 && distance <= 404) {\r\n      rangeResult = \"m\";\r\n      // between 16 and 32 inches\r\n    } else if (distance > 404 && distance <= 808) {\r\n      rangeResult = \"l\";\r\n      // between 32 and max range\r\n    } else if (distance > 808 && distance <= mini1MaxRange) {\r\n      rangeResult = \"xl\";\r\n    } else if (distance > mini1MaxRange) {\r\n      rangeResult = null\r\n    }\r\n\r\n    //check if obstacles between minis;\r\n    //check if angle between mini1 front and mini2 is < 90deg\r\n    if (noObstacle(mini1, mini2) && isInAngle(mini1, mini2)) {\r\n      return rangeResult;\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  var isTheGameOver = () => {\r\n    let winner = \"\";\r\n    if (players.teamBlack.startActions === 0 && players.teamWhite.startActions === 0) {\r\n      console.log(\"tie\")\r\n      winner = null;\r\n      console.log(\"Game Over. No Winners this time.\")\r\n    } else if (players.teamBlack.startActions === 0) {\r\n      winner = \"Team White\";\r\n      console.log(`Game Over. ${winner} wins!`)\r\n    } else if (players.teamWhite.startActions === 0) {\r\n      winner = \"Team Black\";\r\n      console.log(`Game Over. ${winner} wins!`)\r\n    } else {\r\n      winner = undefined;\r\n    }\r\n\r\n    return winner;\r\n  }\r\n\r\n  var getMods = (mini1, mini2) => {\r\n    let team = mini1.name.includes(\"white\") ? \"teamWhite\" : \"teamBlack\";\r\n    let range = rangeToTarget(mini1, mini2);\r\n    let higherMod = isHigher(mini1, mini2) ? 1 : 0;\r\n    let coverMod = isInCover(mini2, mini1) ? -1 : 0;\r\n    let mods = coverMod + higherMod + players[team].armyStats.units[mini1.unit].range.mods[range];\r\n    return mods;\r\n  }\r\n\r\n  var onAttack = (mini1, mini2, response) => {\r\n    let winner = \"\";\r\n    if (mini1) {\r\n      let range = rangeToTarget(mini1, mini2);\r\n      let mini1CoverMod = isInCover(mini1, mini2) ? 1 : 0;\r\n      let mini1Mods = getMods(mini1, mini2);\r\n\r\n      let mini2CoverMod = isInCover(mini2, mini1) ? 1 : 0;\r\n      let mini2Mods = getMods(mini2, mini1);\r\n\r\n      if (range && isInAngle(mini1, mini2)) {\r\n        if (mini2.intersectsMesh(mini1, false) || range === \"c\") {\r\n          //Melee attack\r\n          console.log('Stabbing ' + mini2.id + \" with \" + mini1.id)\r\n          console.log(\"Player target roll: \" + currentPlayer.army.units[mini1.unit].melee.success + \"+\")\r\n          let meleeRoll = diceRoll(currentPlayer.army.units[mini1.unit].melee.roll);\r\n\r\n          //Generate Dice\r\n          cloneDice(meleeRoll, mini1, 1000);\r\n\r\n          console.log(\"Enemy target roll: \" + enemyPlayer.army.units[mini1.unit].melee.success + \"+\")\r\n          let mini2MeleeRoll = diceRoll(1);\r\n          //Generate Dice\r\n          cloneDice(mini2MeleeRoll, mini2, 1000);\r\n\r\n          winner = compareRolls(mini1, meleeRoll, 0, mini2, mini2MeleeRoll, 0);\r\n\r\n        } else {\r\n          //Range attack\r\n          var mini1rolls = [];\r\n          var modedRolls = [];\r\n          var mini2Rolls = [];\r\n\r\n          console.log(`Shooting ${mini2.id} with ${mini1.id} at range ${range}.`)\r\n          // Check for enemy roll (Should be enemy line of sight when rotation is implemented!)\r\n          console.log(mini1.id + \" target roll: \" + currentPlayer.army.units[mini1.unit].range.success + \"+\")\r\n\r\n          if (!response) {\r\n            mini1rolls = diceRoll(mini2.diceAssigned);\r\n          } else {\r\n            mini1rolls = diceRoll(1);\r\n          }\r\n\r\n          //Generate Dice\r\n          cloneDice(mini1rolls, mini1, 1000);\r\n\r\n          modedRolls = mini1rolls.map(roll => roll + mini1Mods);\r\n\r\n          //Enemy Target Response\r\n          if (rangeToTarget(mini2, mini1) && !response) {\r\n            console.log(mini2.id + \" target roll: \" + enemyPlayer.army.units[mini2.unit].range.success + \"+\")\r\n\r\n            mini2Rolls = diceRoll(1);\r\n            //Generate Dice\r\n            cloneDice(mini2Rolls, mini2, 1000);\r\n\r\n            winner = compareRolls(mini1, mini1rolls, mini1Mods, mini2, mini2Rolls, mini2Mods);\r\n          }\r\n\r\n          //No response from enemy (range difference || angle || one way response)\r\n          if (!winner) {\r\n            if (modedRolls.some(roll => roll >= currentPlayer.army.units[mini1.unit].range.success)) {\r\n              if (!response) {\r\n                console.log(\"Player rolled:\")\r\n                console.log(mini1rolls);\r\n                console.log(\"Success! You shot him!\");\r\n              } else {\r\n                console.log(\"Enemy rolled:\")\r\n                console.log(mini1rolls);\r\n                console.log(\"Hot damn! You got shot!\");\r\n              }\r\n              winner = mini1.name;\r\n            }\r\n          }\r\n        }\r\n\r\n        //Defense Roll\r\n        if (winner === mini1.name) {\r\n          console.log(mini2.id + \" is hit. Defense roll target: \" + players[mini2.team].armyStats.units[mini2.unit].defense.success + \"+\");\r\n          if (mini2CoverMod > 0) {\r\n            console.log(mini2.id + \" has +1 to dice roll as he is in cover.\")\r\n          }\r\n          let defenseRoll = diceRoll(players[mini2.team].armyStats.units[mini2.unit].defense.roll)\r\n          console.log(mini2.team + \" player rolls : \");\r\n          console.log(defenseRoll);\r\n          setTimeout(function () {\r\n            cloneDice(defenseRoll, mini2, 1250, true);\r\n          }, 1250);\r\n          //Cover modifiers to add here\r\n          if (defenseRoll.some(roll => roll + mini2CoverMod >= players[mini2.team].armyStats.units[mini2.unit].defense.success)) {\r\n            console.log(\"Defense roll successful. \" + mini2.id + \" saved!\");\r\n          } else {\r\n            console.log(mini2.id + \" killed!\");\r\n            setTimeout(function () {\r\n              mini2.position = new BABYLON.Vector3(Math.floor(Math.random() * 190) - 200, 0, -440 + Math.floor(Math.random() * 30) - 15);\r\n              mini2.name = \"decor\";\r\n              mini2.isPickable = false;\r\n              if (scene.getMeshByName(`${mini2.id}To${mini1.id}`)) {\r\n                scene.removeMesh(scene.getMeshByName(`${mini2.id}To${mini1.id}`));\r\n              }\r\n              players[mini2.team].minis = players[mini2.team].minis.filter(mini => mini.id !== mini2.id)\r\n              players[mini2.team].startActions -= 2;\r\n              removeCoverLogo(mini2);\r\n              clearTarget(mini2);\r\n              if (response) {\r\n                cancelSelection();\r\n              }\r\n            }, 2500);\r\n          }\r\n        } else if (winner === mini2.name) {\r\n          console.log(mini1.id + \" is hit. Defense roll target: \" + players[mini1.team].armyStats.units[mini1.unit].defense.success + \"+\")\r\n          if (mini1CoverMod > 0) {\r\n            console.log(mini1.id + \" has +1 to dice roll as he is in cover.\")\r\n          }\r\n          let defenseRoll = diceRoll(players[mini1.team].armyStats.units[mini1.unit].defense.roll, null, true, mini1);\r\n          console.log(mini1.team + \" player rolls : \");\r\n          console.log(defenseRoll);\r\n          setTimeout(function () {\r\n            cloneDice(defenseRoll, mini1, 1250, true);\r\n          }, 1250);\r\n          if (defenseRoll.some(roll => roll + mini1CoverMod >= players[mini1.team].armyStats.units[mini1.unit].defense.success)) {\r\n            console.log(\"Defense roll successful. \" + mini1.id + \" saved!\");\r\n          } else {\r\n            console.log(mini1.id + \" killed!\");\r\n            setTimeout(function () {\r\n              camera.target = map;\r\n              mini1.position = new BABYLON.Vector3(200 - Math.floor(Math.random() * 190), 0, -440 + Math.floor(Math.random() * 30) - 15);\r\n              mini1.name = \"decor\";\r\n              mini1.isPickable = false\r\n              players[mini1.team].minis = players[mini1.team].minis.filter(mini => mini.id !== mini1.id)\r\n              players[mini1.team].startActions -= 2;\r\n              removeCoverLogo(mini1);\r\n              cancelSelection();\r\n            }, 2500);\r\n          }\r\n        } else {\r\n          console.log(\"No winners! Try again.\")\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  const attackTargets = async () => {\r\n    inAttack = true;\r\n    const waitFor = (ms) => new Promise(r => setTimeout(r, ms));\r\n    if (selected && targets && targets.length > 0) {\r\n      let enemyResponse = players[enemyPlayer.team].minis.filter(mini =>\r\n        enemyPlayer.army.units[mini.unit].range.mods[rangeToTarget(mini, selected)] >= 0\r\n      );\r\n      let onWayResponse = enemyResponse.filter(enemy => !targets.some(target => target === enemy));\r\n\r\n      await asyncForEach(targets, async (target) => {\r\n        console.log(`Init attack on ${target.id}!`)\r\n        if (selected) {\r\n          onAttack(selected, target);\r\n        }\r\n        await waitFor(3000);\r\n        console.log(`Attack on ${target.id} completed!`)\r\n      });\r\n      if (onWayResponse) {\r\n        await asyncForEach(onWayResponse, async (enemy) => {\r\n          console.log(`Init one way attack from ${enemy.id}!`)\r\n          if (selected) {\r\n            onAttack(enemy, selected, true);\r\n          }\r\n          await waitFor(3000);\r\n          console.log(`One way attack from ${enemy.id} completed!`)\r\n        });\r\n      }\r\n      console.log('Done with attacks.');\r\n      players[currentPlayer.team].turnActions -= 1;\r\n      scene.removeMesh(scene.getMeshByName(\"token\"));\r\n      cancelLineOfSight();\r\n      cancelSelection();\r\n      isTheGameOver();\r\n      inAttack = false;\r\n\r\n      if (players[currentPlayer.team].turnActions === 0) {\r\n        setTimeout(function () {\r\n          switchPlayer();\r\n        }, 3500);\r\n      }\r\n    }\r\n  }\r\n\r\n  var rollButton = GUI.Button.CreateSimpleButton(\"rollButton\", \"Roll Dice\");\r\n  rollButton.width = \"120px\"\r\n  rollButton.height = \"60px\";\r\n  rollButton.color = \"white\";\r\n  rollButton.left = \"40%\";\r\n  rollButton.top = \"30%\";\r\n  rollButton.cornerRadius = 20;\r\n  rollButton.background = \"black\";\r\n  rollButton.zIndex = 2000;\r\n  rollButton.onPointerClickObservable.add(function () {\r\n    if (!inAttack) {\r\n      attackTargets();\r\n    }\r\n  });\r\n\r\n  var moveAction = ({ skip }) => {\r\n    if (selected) {\r\n      if (!skip) {\r\n        previous.position = selected.position;\r\n        selected.position = clonedMini.position;\r\n      }\r\n      moveArea.position = new BABYLON.Vector3(selected.position.x, 26, selected.position.z);\r\n      moveArea.setEnabled(false);\r\n      scene.getMeshByName(`${selected.id}lineOfSight`).setEnabled(true);\r\n\r\n      //Fragment diffuse on main LOS and creating ground LOS clone\r\n      if (whatIsUnderneath(selected) && whatIsUnderneath(selected).name.includes(\"obstacle\")) {\r\n        if (scene.getMeshByName(`groundLOS${selected.id}`)) {\r\n          scene.getMeshByName(`groundLOS${selected.id}`).position.y = - selected.position.y + 26;\r\n          scene.getMeshByName(`groundLOS${selected.id}`).setEnabled(true);\r\n        } else {\r\n          scene.getMeshByName(`${selected.id}lineOfSight`).clone(`groundLOS${selected.id}`).position.y = - selected.position.y + 26;\r\n        }\r\n\r\n        if (scene.getMeshByName(\"groundMoveArea\")) {\r\n          scene.getMeshByName(\"groundMoveArea\").position.y = selected.position.y - getHeight(selected) / 2 - 5;\r\n        } else {\r\n          moveArea.clone(\"groundMoveArea\");\r\n          scene.getMeshByName(\"groundMoveArea\").parent = moveArea;\r\n          scene.getMeshByName(\"groundMoveArea\").position = new BABYLON.Vector3(0, selected.position.y - getHeight(selected) / 2 - 5, 0);\r\n        }\r\n\r\n        let obstacleTemplateArea = `if( vPositionW.z  < ${Math.round(whatIsUnderneath(selected).position.z - getLength(whatIsUnderneath(selected)) / 2)}.){ discard; } if( vPositionW.z  > ${Math.round(whatIsUnderneath(selected).position.z + getLength(whatIsUnderneath(selected)) / 2)}.){ discard; } if( vPositionW.x  > ${Math.round(whatIsUnderneath(selected).position.x + getWidth(whatIsUnderneath(selected)) / 2)}.){ discard; } if( vPositionW.x  < ${Math.round(whatIsUnderneath(selected).position.x - getWidth(whatIsUnderneath(selected)) / 2)}.){ discard; }`;\r\n        let highMat = new CustomMaterial(\"highMat\", scene);\r\n        highMat.alpha = 0.25;\r\n        highMat.Fragment_Custom_Diffuse(obstacleTemplateArea);\r\n        highMat.diffuseColor = scene.getMaterialByName(selected.losMat[0]).diffuseColor;\r\n\r\n        scene.getMeshByName(`${selected.id}lineOfSight`).material = highMat;\r\n        scene.getMeshByName(`${selected.id}lineOfSight`)._children.forEach((los, index) => {\r\n          los.material = new CustomMaterial(`highMat${index}`, scene);\r\n          los.material.alpha = 0.25;\r\n          los.material.Fragment_Custom_Diffuse(obstacleTemplateArea);\r\n          los.material.diffuseColor = scene.getMaterialByName(selected.losMat[index + 1]).diffuseColor;\r\n        });\r\n        scene.getMeshByName(\"groundMoveArea\").material = new CustomMaterial(`highMoveMat`, scene);\r\n        scene.getMeshByName(\"groundMoveArea\").material.alpha = 0.25;\r\n        scene.getMeshByName(\"groundMoveArea\").material.Fragment_Custom_Diffuse(obstacleTemplateArea);\r\n        scene.getMeshByName(\"groundMoveArea\")._children.forEach(child => child.setEnabled(false));\r\n      } else {\r\n        scene.getMeshByName(`${selected.id}lineOfSight`).material = scene.getMaterialByName(selected.losMat[0]);\r\n        scene.getMeshByName(`${selected.id}lineOfSight`)._children.forEach((los, index) => los.material = scene.getMaterialByName(selected.losMat[index + 1]));\r\n        moveArea2.material = moveAreaMat;\r\n        if (scene.getMeshByName(`groundLOS${selected.id}`)) {\r\n          scene.getMeshByName(`groundLOS${selected.id}`).dispose();\r\n        }\r\n        if (scene.getMeshByName(\"groundMoveArea\")) {\r\n          scene.getMeshByName(\"groundMoveArea\").dispose();\r\n        }\r\n      };\r\n\r\n      previous.rotation = selected.rotation.clone();\r\n      rotate = true;\r\n    }\r\n  }\r\n\r\n  var forwardDirection = (mini) => {\r\n    let forward = new BABYLON.Vector3(0, 0, -1);\r\n    let direction = mini.getDirection(forward);\r\n    direction.normalize();\r\n    return direction;\r\n  }\r\n\r\n  var rotateOnMouseMove = (evt) => {\r\n    evt.preventDefault();\r\n    if (selected && getGroundPosition(evt)) {\r\n      var diffX = selected.position.x - getGroundPosition(evt).x;\r\n      var diffY = selected.position.z - getGroundPosition(evt).z;\r\n      selected.rotation.y = Math.atan2(diffX, diffY);\r\n    }\r\n  }\r\n\r\n  var rotateAction = (evt) => {\r\n    if (evt.which === 1 || evt.sourceEvent.which === 1) {\r\n      if (selected && rotate) {\r\n        players[currentPlayer.team].turnActions -= 1;\r\n        scene.removeMesh(scene.getMeshByName(\"token\"));\r\n        rotate = false;\r\n        previous.position = null;\r\n        previous.rotation = null;\r\n        cancelSelection();\r\n\r\n        if (players[currentPlayer.team].turnActions === 0) {\r\n          setTimeout(function () {\r\n            switchPlayer();\r\n          }, 1000);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  var onMouseMove = function (evt) {\r\n    evt.preventDefault();\r\n    if (selected && getGroundPosition(evt)) {\r\n      let otherMinis = [...players[enemyPlayer.team].minis, ...players[currentPlayer.team].minis.filter(mini => mini.id !== selected.id)];\r\n      //Miniature collision\r\n      if (!otherMinis.some(mini =>\r\n        getGroundPosition(evt).x < mini.position.x + getWidth(mini) - 2 &&\r\n        getGroundPosition(evt).x > mini.position.x - getWidth(mini) + 2 &&\r\n        getGroundPosition(evt).z < mini.position.z + getWidth(mini) - 2 &&\r\n        getGroundPosition(evt).z > mini.position.z - getWidth(mini) + 2\r\n      )) {\r\n        //Obstacle collision\r\n        if (\r\n          !obstacles.filter(obstacle => getHeight(obstacle) + obstacle.position.y - (getHeight(obstacle) / 2) > getHeight(selected) + selected.position.y).some(obstacle =>\r\n            getGroundPosition(evt).x < obstacle.position.x + getWidth(obstacle) / 2 + getWidth(selected) / 2 &&\r\n            getGroundPosition(evt).x > obstacle.position.x - getWidth(obstacle) / 2 - getWidth(selected) / 2 &&\r\n            getGroundPosition(evt).z < obstacle.position.z + getLength(obstacle) / 2 + getWidth(selected) / 2 &&\r\n            getGroundPosition(evt).z > obstacle.position.z - getLength(obstacle) / 2 - getWidth(selected) / 2\r\n          )\r\n        ) {\r\n          //game area limits\r\n          if (getGroundPosition(evt).x > -388 && getGroundPosition(evt).x < 388 && getGroundPosition(evt).z > -285 && getGroundPosition(evt).z < 285) {\r\n            //Filtering out obstacles shorter than mini size. Allows vertical move.\r\n            var currentObstacle = obstacles.filter(obstacle => getHeight(obstacle) < getHeight(selected) + selected.position.y - 25).filter(obstacle =>\r\n              getGroundPosition(evt).x < obstacle.position.x + getWidth(obstacle) / 2 + getWidth(selected) / 2 &&\r\n              getGroundPosition(evt).x > obstacle.position.x - getWidth(obstacle) / 2 - getWidth(selected) / 2 &&\r\n              getGroundPosition(evt).z < obstacle.position.z + getLength(obstacle) / 2 + getWidth(selected) / 2 &&\r\n              getGroundPosition(evt).z > obstacle.position.z - getLength(obstacle) / 2 - getWidth(selected) / 2\r\n            );\r\n            if (currentObstacle && currentObstacle.length > 0) {\r\n              //Vertical move\r\n              clonedMini.position = new BABYLON.Vector3(getGroundPosition(evt).x, getHeight(currentObstacle[0]) + 26, getGroundPosition(evt).z);\r\n            } else {\r\n              //Regular move\r\n              clonedMini.position = new BABYLON.Vector3(getGroundPosition(evt).x, 25, getGroundPosition(evt).z);\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  var getGroundPosition = function () {\r\n    // Use a predicate to get position on the ground\r\n    var pickinfo = scene.pick(scene.pointerX, scene.pointerY, function (mesh) { return mesh === map; });\r\n    if (pickinfo.hit) {\r\n      return pickinfo.pickedPoint;\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  const addTarget = (enemyTarget) => {\r\n    advancedTexture.addControl(rollButton);\r\n    updateDiceStat();\r\n    let targetColor = new BABYLON.Color3.Black();\r\n    if (selected && !targets.some(target => target.id === enemyTarget.id)) {\r\n      if (getLosColor(selected.unit, currentPlayer.team, rangeToTarget(selected, enemyTarget))) {\r\n        targetColor = getLosColor(selected.unit, currentPlayer.team, rangeToTarget(selected, enemyTarget));\r\n      }\r\n      hl.addMesh(enemyTarget, targetColor);\r\n      targets.push(enemyTarget);\r\n      // create direct line of sight\r\n      if (rangeToTarget(selected, enemyTarget) !== \"c\") {\r\n        createDirectLOS(selected, enemyTarget, false);\r\n      }\r\n      createDiceStat(enemyTarget);\r\n      targetResponse();\r\n    }\r\n  }\r\n\r\n  const clearTarget = (target) => {\r\n    if (target) {\r\n      target.diceAssigned = 0;\r\n    }\r\n    // Removed any target from the targets array with 0 dice assigned\r\n    targets.forEach((target, index) => {\r\n      if (target.diceAssigned === 0) {\r\n        targets.splice(index, 1);\r\n        hl.removeMesh(target);\r\n        removeDiceStat(target);\r\n        scene.removeMesh(scene.getMeshByName(`${selected.id}To${target.id}`));\r\n      }\r\n    });\r\n  }\r\n\r\n  const calculateSuccess = (mini1, mini2) => {\r\n    let mods;\r\n    let success;\r\n    if (rangeToTarget(mini1, mini2) === \"c\") {\r\n      success = currentPlayer.army.units.soldier.melee.success;\r\n    } else {\r\n      mods = getMods(mini1, mini2);\r\n      success = currentPlayer.army.units.soldier.range.success - mods\r\n    }\r\n    return success\r\n  }\r\n\r\n  const createDiceStat = (enemyTarget) => {\r\n    if (selected) {\r\n      let roll = enemyTarget.diceAssigned;\r\n      let success = calculateSuccess(selected, enemyTarget)\r\n      let diceStat = new GUI.TextBlock(`${enemyTarget.id}diceStat`);\r\n      diceStat.text = `${roll}d${success}+`;\r\n      diceStat.color = \"white\";\r\n      diceStat.fontFamily = \"Arial\";\r\n      diceStat.fontSize = \"15px\";\r\n      advancedTexture.addControl(diceStat);\r\n\r\n      diceStat.linkWithMesh(enemyTarget);\r\n      diceStat.linkOffsetY = -40;\r\n    }\r\n  };\r\n\r\n  const removeDiceStat = (enemyTarget) => {\r\n    if (getControlByName(`${enemyTarget.id}diceStat`)) {\r\n      getControlByName(`${enemyTarget.id}diceStat`).dispose();\r\n    }\r\n  };\r\n\r\n  const updateDiceStat = () => {\r\n    if (targets && targets.length > 0) {\r\n      targets.forEach(target => {\r\n        removeDiceStat(target);\r\n        createDiceStat(target);\r\n      });\r\n    }\r\n  }\r\n\r\n  const assignTarget = (ev) => {\r\n    let enemyTarget = ev.meshUnderPointer;\r\n\r\n    var whoHasMoreDice = targets.map(target => target.diceAssigned).indexOf(Math.max(...targets.filter(target => target.id !== enemyTarget.id).map(target => target.diceAssigned)));\r\n    if (selected && enemyTarget && enemyTarget.name.includes(\"Mini\") && rangeToTarget(selected, enemyTarget) && calculateSuccess(selected, enemyTarget) <= 6) {\r\n      moveArea.setEnabled(false);\r\n      if (targets.length === 0) {\r\n        enemyTarget.diceAssigned = currentPlayer.army.units[selected.unit].range.roll;\r\n        addTarget(enemyTarget);\r\n      } else if (whoHasMoreDice >= 0 && targets.reduce((acc, target) => acc + target.diceAssigned, 0) === currentPlayer.army.units[selected.unit].range.roll && targets.filter(target => target.id !== enemyTarget.id).every(target => target.diceAssigned >= 1)) {\r\n        enemyTarget.diceAssigned ? enemyTarget.diceAssigned += 1 : enemyTarget.diceAssigned = 1;\r\n        targets[whoHasMoreDice].diceAssigned -= 1;\r\n        addTarget(enemyTarget);\r\n        clearTarget();\r\n      } else {\r\n        if (targets.length > 1 && targets.every(target => target.diceAssigned === 1)) {\r\n          let removedTarget = targets.splice(targets.indexOf(targets[whoHasMoreDice]), 1)[0];\r\n          clearTarget(removedTarget);\r\n          enemyTarget.diceAssigned ? enemyTarget.diceAssigned += 1 : enemyTarget.diceAssigned = 1;\r\n          addTarget(enemyTarget);\r\n        }\r\n        if (enemyTarget.diceAssigned === currentPlayer.army.units[selected.unit].range.roll) {\r\n          clearTarget(enemyTarget);\r\n          cancelTargeting();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  const createDirectLOS = (mini1, mini2, response) => {\r\n    let origin;\r\n    let target;\r\n    if (response) {\r\n      origin = new BABYLON.Vector3(mini1.position.x, mini1.position.y + getHeight(mini1) * 0.70, mini1.position.z);\r\n      target = new BABYLON.Vector3(mini2.position.x, mini2.position.y + getHeight(mini2) * 0.70, mini2.position.z);\r\n      let colorArray1 = [new BABYLON.Color4(215 / 255, 195 / 255, 58 / 255, 1), new BABYLON.Color4(0, 0, 0, 0)];\r\n      BABYLON.MeshBuilder.CreateLines(`${mini1.id}To${mini2.id}`, { points: [origin, target], colors: colorArray1, updatable: true }, scene);\r\n    } else {\r\n      origin = new BABYLON.Vector3(mini1.position.x, mini1.position.y + getHeight(mini1) * 0.80, mini1.position.z);\r\n      target = new BABYLON.Vector3(mini2.position.x, mini2.position.y + getHeight(mini2) * 0.80, mini2.position.z);\r\n      let colorArray2 = [new BABYLON.Color4(1, 1, 1, 1), new BABYLON.Color4(0, 0, 0, 0)]\r\n      BABYLON.MeshBuilder.CreateLines(`${mini1.id}To${mini2.id}`, { points: [origin, target], colors: colorArray2, updatable: true }, scene);\r\n    }\r\n  }\r\n\r\n  const targetResponse = () => {\r\n    if (selected && targets) {\r\n      players[enemyPlayer.team].minis.forEach(mini => {\r\n        if (!scene.getMeshByName(`${mini.id}To${selected.id}`)) {\r\n          if (enemyPlayer.army.units[mini.unit].range.mods[rangeToTarget(mini, selected)] >= 0 || scene.getMeshByName(`${selected.id}To${mini.id}`)) {\r\n            createDirectLOS(mini, selected, true);\r\n          }\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  moveActionManager.registerAction(\r\n    new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOverTrigger, function (ev) {\r\n      clonedMini = selected.clone();\r\n      clonedMini.position = selected.position;\r\n      clonedMini.isPickable = false;\r\n      clonedMini._children.forEach(child => child.setEnabled(false));\r\n\r\n      clonedMini.material = transparentMaterial;\r\n      canvas.addEventListener(\"mousemove\", onMouseMove, false);\r\n      canvas.addEventListener(\"click\", moveAction, false);\r\n    })\r\n  );\r\n\r\n  moveActionManager.registerAction(\r\n    new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOutTrigger, function (ev) {\r\n      clonedMini.dispose();\r\n      canvas.removeEventListener(\"mousemove\", onMouseMove);\r\n      canvas.removeEventListener(\"click\", moveAction);\r\n    })\r\n  );\r\n\r\n  mapActionManager.registerAction(\r\n    new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOverTrigger, function (ev) {\r\n      if (selected && rotate) {\r\n        scene.getMeshByName(`${selected.id}lineOfSight`).setEnabled(true)\r\n      }\r\n      if (rotate) {\r\n        canvas.addEventListener(\"mousemove\", rotateOnMouseMove, false);\r\n        canvas.addEventListener(\"click\", rotateAction, false);\r\n      }\r\n    })\r\n  );\r\n\r\n  mapActionManager.registerAction(\r\n    new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOutTrigger, function (ev) {\r\n      if (selected && !rotate) {\r\n        scene.getMeshByName(`${selected.id}lineOfSight`).setEnabled(false);\r\n        if (scene.getMeshByName(`groundLOS${selected.id}`)) {\r\n          scene.getMeshByName(`groundLOS${selected.id}`).setEnabled(false);\r\n        }\r\n      }\r\n      canvas.removeEventListener(\"mousemove\", rotateOnMouseMove);\r\n      canvas.removeEventListener(\"click\", rotateAction);\r\n    })\r\n  );\r\n\r\n  //Select current player mini\r\n  teamBlackActionManager.registerAction(\r\n    new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickUpTrigger, function (ev) {\r\n      if (currentPlayer.team === \"teamBlack\" && !inAttack) {\r\n        if (rotate) {\r\n          rotateAction(ev);\r\n        } else {\r\n          selection(ev);\r\n        }\r\n      }\r\n    })\r\n  );\r\n  //Attack opposite team\r\n  teamBlackActionManager.registerAction(\r\n    new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnLeftPickTrigger, function (ev) {\r\n      if (currentPlayer.team === \"teamWhite\" && !rotate && !inAttack) {\r\n        //onAttack(ev);\r\n        assignTarget(ev);\r\n      }\r\n    })\r\n  );\r\n\r\n  //LOS on opposite team\r\n  teamBlackActionManager.registerAction(\r\n    new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOverTrigger, function (ev) {\r\n      if (currentPlayer.team === \"teamWhite\" && !inAttack) {\r\n        handleLineOfSight(ev);\r\n      }\r\n    })\r\n  );\r\n\r\n  teamBlackActionManager.registerAction(\r\n    new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOutTrigger, function (ev) {\r\n      if (currentPlayer.team === \"teamWhite\") {\r\n        cancelLineOfSight();\r\n      }\r\n    })\r\n  );\r\n\r\n\r\n  //Select current player mini\r\n  teamWhiteActionManager.registerAction(\r\n    new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPickUpTrigger, function (ev) {\r\n      if (currentPlayer.team === \"teamWhite\" && !inAttack) {\r\n        if (rotate) {\r\n          rotateAction(ev);\r\n        } else {\r\n          selection(ev);\r\n        }\r\n      }\r\n    })\r\n  );\r\n  //Attack opposite team\r\n  teamWhiteActionManager.registerAction(\r\n    new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnLeftPickTrigger, function (ev) {\r\n      if (currentPlayer.team === \"teamBlack\" && !rotate) {\r\n        //onAttack(ev);\r\n        assignTarget(ev);\r\n      }\r\n    })\r\n  );\r\n\r\n  //LOS on opposite team\r\n  teamWhiteActionManager.registerAction(\r\n    new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOverTrigger, function (ev) {\r\n      if (currentPlayer.team === \"teamBlack\" && !inAttack) {\r\n        handleLineOfSight(ev);\r\n      }\r\n    })\r\n  );\r\n\r\n  teamWhiteActionManager.registerAction(\r\n    new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnPointerOutTrigger, function (ev) {\r\n      if (currentPlayer.team === \"teamBlack\") {\r\n        cancelLineOfSight();\r\n      }\r\n    })\r\n  );\r\n\r\n  canvas.addEventListener('contextmenu', cancelSelection, false);\r\n  scene.onDispose = function () {\r\n    canvas.removeEventListener(\"mousemove\", onMouseMove);\r\n    canvas.removeEventListener(\"contextmenu\", cancelSelection);\r\n  }\r\n}\r\n\r\nexport default () => (\r\n  <div >\r\n    <SceneComponent className=\"w-full h-full\" antialias onSceneReady={onSceneReady} id='my-canvas' />\r\n  </div>\r\n)","import React from 'react';\nimport './App.css';\nimport Scene from './components/Scene';\n\nconst App = () => (\n  <div className=\"w-full h-full overflow-hidden\">\n    <Scene />\n  </div>\n);\n\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './tailwind.output.css';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}